
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <title>ç¼“å†²åè®® &#8212; Python 3.8.2 æ–‡æ¡£</title>
    <link rel="stylesheet" href="pydoctheme.css" tppabs="https://docs.python.org/zh-cn/3/_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="pygments.css" tppabs="https://docs.python.org/zh-cn/3/_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="documentation_options.js" tppabs="https://docs.python.org/zh-cn/3/_static/documentation_options.js"></script>
    <script type="text/javascript" src="jquery.js" tppabs="https://docs.python.org/zh-cn/3/_static/jquery.js"></script>
    <script type="text/javascript" src="underscore.js" tppabs="https://docs.python.org/zh-cn/3/_static/underscore.js"></script>
    <script type="text/javascript" src="doctools.js" tppabs="https://docs.python.org/zh-cn/3/_static/doctools.js"></script>
    <script type="text/javascript" src="language_data.js" tppabs="https://docs.python.org/zh-cn/3/_static/language_data.js"></script>
    <script type="text/javascript" src="translations.js" tppabs="https://docs.python.org/zh-cn/3/_static/translations.js"></script>
    
    <script type="text/javascript" src="sidebar.js" tppabs="https://docs.python.org/zh-cn/3/_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="åœ¨ Python 3.8.2 æ–‡æ¡£ ä¸­æœç´¢"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="å…³äºè¿™äº›æ–‡æ¡£" href="../about.html" />
    <link rel="index" title="ç´¢å¼•" href="../genindex.html" />
    <link rel="search" title="æœç´¢" href="../search.html" />
    <link rel="copyright" title="ç‰ˆæƒæ‰€æœ‰" href="../copyright.html" />
    <link rel="next" title="æ—§ç¼“å†²åè®®" href="objbuffer.html" />
    <link rel="prev" title="è¿­ä»£å™¨åè®®" href="iter.html" />
    <link rel="canonical" href="https://docs.python.org/3/c-api/buffer.html" />
    
      
      <script type="text/javascript" src="switchers.js" tppabs="https://docs.python.org/zh-cn/3/_static/switchers.js"></script>
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>

    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    
    <script type="text/javascript" src="copybutton.js" tppabs="https://docs.python.org/zh-cn/3/_static/copybutton.js"></script>
    
     


  </head><body>
  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>å¯¼èˆª</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" tppabs="https://docs.python.org/zh-cn/3/genindex.html" title="æ€»ç›®å½•"
             accesskey="I">ç´¢å¼•</a></li>
        <li class="right" >
          <a href="py-modindex.html" tppabs="https://docs.python.org/zh-cn/3/py-modindex.html" title="Python æ¨¡å—ç´¢å¼•"
             >æ¨¡å—</a> |</li>
        <li class="right" >
          <a href="objbuffer.html" tppabs="https://docs.python.org/zh-cn/3/c-api/objbuffer.html" title="æ—§ç¼“å†²åè®®"
             accesskey="N">ä¸‹ä¸€é¡µ</a> |</li>
        <li class="right" >
          <a href="iter.html" tppabs="https://docs.python.org/zh-cn/3/c-api/iter.html" title="è¿­ä»£å™¨åè®®"
             accesskey="P">ä¸Šä¸€é¡µ</a> |</li>

    <li><img src="py.png" tppabs="https://docs.python.org/zh-cn/3/_static/py.png" alt=""
             style="vertical-align: middle; margin-top: -1px"/></li>
    <li><a href="javascript:if(confirm('https://www.python.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.python.org/'" tppabs="https://www.python.org/">Python</a> &#187;</li>
    

    <li>
      <span class="language_switcher_placeholder">zh_CN</span>
      <span class="version_switcher_placeholder">3.8.2</span>
      <a href="index-11.html" tppabs="https://docs.python.org/zh-cn/3/index.html">æ–‡æ¡£</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index-9.html" tppabs="https://docs.python.org/zh-cn/3/c-api/index.html" >Python/C API å‚è€ƒæ‰‹å†Œ</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="abstract.html" tppabs="https://docs.python.org/zh-cn/3/c-api/abstract.html" accesskey="U">æŠ½è±¡å¯¹è±¡å±‚</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="https://docs.python.org/zh-cn/3/search.html" method="get">
          <input placeholder="å¿«é€Ÿæœç´¢" type="text" name="q" />
          <input type="submit" value="è½¬å‘" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="buffer-protocol">
<span id="bufferobjects"></span><span id="index-0"></span><h1>ç¼“å†²åè®®<a class="headerlink" href="#buffer-protocol" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h1>
<p>åœ¨ Python ä¸­å¯ä½¿ç”¨ä¸€äº›å¯¹è±¡æ¥åŒ…è£…å¯¹åº•å±‚å†…å­˜æ•°ç»„æˆ–ç§° <em>ç¼“å†²</em> çš„è®¿é—®ã€‚æ­¤ç±»å¯¹è±¡åŒ…æ‹¬å†…ç½®çš„ <a class="reference internal" href="stdtypes.html#bytes" tppabs="https://docs.python.org/zh-cn/3/library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> å’Œ <a class="reference internal" href="stdtypes.html#bytearray" tppabs="https://docs.python.org/zh-cn/3/library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> ä»¥åŠä¸€äº›å¦‚ <a class="reference internal" href="array.html#array.array" tppabs="https://docs.python.org/zh-cn/3/library/array.html#array.array" title="array.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array.array</span></code></a> è¿™æ ·çš„æ‰©å±•ç±»å‹ã€‚ç¬¬ä¸‰æ–¹åº“ä¹Ÿå¯èƒ½ä¼šä¸ºäº†ç‰¹æ®Šçš„ç›®çš„è€Œå®šä¹‰å®ƒä»¬è‡ªå·±çš„ç±»å‹ï¼Œä¾‹å¦‚ç”¨äºå›¾åƒå¤„ç†å’Œæ•°å€¼åˆ†æç­‰ã€‚</p>
<p>è™½ç„¶è¿™äº›ç±»å‹ä¸­çš„æ¯ä¸€ç§éƒ½æœ‰è‡ªå·±çš„è¯­ä¹‰ï¼Œä½†å®ƒä»¬å…·æœ‰ç”±å¯èƒ½è¾ƒå¤§çš„å†…å­˜ç¼“å†²åŒºæ”¯æŒçš„å…±åŒç‰¹å¾ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¸Œæœ›ç›´æ¥è®¿é—®è¯¥ç¼“å†²åŒºè€Œæ— éœ€ä¸­é—´å¤åˆ¶ã€‚</p>
<p>Python ä»¥ <a class="reference internal" href="#bufferobjects"><span class="std std-ref">ç¼“å†²åè®®</span></a> çš„å½¢å¼åœ¨ C å±‚çº§ä¸Šæä¾›è¿™æ ·çš„åŠŸèƒ½ã€‚ æ­¤åè®®åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢:</p>
<ul class="simple" id="index-1">
<li><p>åœ¨ç”Ÿäº§è€…è¿™ä¸€æ–¹é¢ï¼Œè¯¥ç±»å‹çš„åè®®å¯ä»¥å¯¼å‡ºä¸€ä¸ªâ€œç¼“å†²åŒºæ¥å£â€ï¼Œå…è®¸å…¬å¼€å®ƒçš„åº•å±‚ç¼“å†²åŒºä¿¡æ¯ã€‚è¯¥æ¥å£çš„æè¿°ä¿¡æ¯åœ¨ <a class="reference internal" href="typeobj.html#buffer-structs" tppabs="https://docs.python.org/zh-cn/3/c-api/typeobj.html#buffer-structs"><span class="std std-ref">Buffer Object Structures</span></a> ä¸€èŠ‚ä¸­ï¼›</p></li>
<li><p>åœ¨æ¶ˆè´¹è€…ä¸€ä¾§ï¼Œæœ‰å‡ ç§æ–¹æ³•å¯ç”¨äºè·å¾—æŒ‡å‘å¯¹è±¡çš„åŸå§‹åº•å±‚æ•°æ®çš„æŒ‡é’ˆï¼ˆä¾‹å¦‚ä¸€ä¸ªæ–¹æ³•çš„å½¢å‚ï¼‰ã€‚</p></li>
</ul>
<p>ä¸€äº›ç®€å•çš„å¯¹è±¡ä¾‹å¦‚ <a class="reference internal" href="stdtypes.html#bytes" tppabs="https://docs.python.org/zh-cn/3/library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> å’Œ <a class="reference internal" href="stdtypes.html#bytearray" tppabs="https://docs.python.org/zh-cn/3/library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> ä¼šä»¥é¢å‘å­—èŠ‚çš„å½¢å¼å…¬å¼€å®ƒä»¬çš„åº•å±‚ç¼“å†²åŒºã€‚ ä¹Ÿå¯èƒ½ä¼šç”¨å…¶ä»–å½¢å¼ï¼›ä¾‹å¦‚ <a class="reference internal" href="array.html#array.array" tppabs="https://docs.python.org/zh-cn/3/library/array.html#array.array" title="array.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array.array</span></code></a> æ‰€å…¬å¼€çš„å…ƒç´ å¯ä»¥æ˜¯å¤šå­—èŠ‚å€¼ã€‚</p>
<p>ç¼“å†²åŒºæ¥å£çš„æ¶ˆè´¹è€…çš„ä¸€ä¸ªä¾‹å­æ˜¯æ–‡ä»¶å¯¹è±¡çš„ <a class="reference internal" href="io.html#io.BufferedIOBase.write" tppabs="https://docs.python.org/zh-cn/3/library/io.html#io.BufferedIOBase.write" title="io.BufferedIOBase.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write()</span></code></a> æ–¹æ³•ï¼šä»»ä½•å¯ä»¥è¾“å‡ºä¸ºä¸€ç³»åˆ—å­—èŠ‚æµçš„å¯¹è±¡å¯ä»¥è¢«å†™å…¥æ–‡ä»¶ã€‚ç„¶è€Œ <code class="xref py py-meth docutils literal notranslate"><span class="pre">write()</span></code> æ–¹æ³•åªéœ€è¦å¯¹äºä¼ å…¥å¯¹è±¡çš„åªè¯»æƒé™ï¼Œå…¶ä»–çš„æ–¹æ³•ï¼Œå¦‚ <a class="reference internal" href="io.html#io.BufferedIOBase.readinto" tppabs="https://docs.python.org/zh-cn/3/library/io.html#io.BufferedIOBase.readinto" title="io.BufferedIOBase.readinto"><code class="xref py py-meth docutils literal notranslate"><span class="pre">readinto()</span></code></a> éœ€è¦å‚æ•°å†…å®¹çš„å†™å…¥æƒé™ã€‚ç¼“å†²åŒºæ¥å£ä½¿å¾—å¯¹è±¡å¯ä»¥é€‰æ‹©æ€§åœ°å…è®¸æˆ–æ‹’ç»è¯»å†™æˆ–åªè¯»ç¼“å†²åŒºçš„å¯¼å‡ºã€‚</p>
<p>å¯¹äºç¼“å†²æ¥å£çš„æ¶ˆè´¹è€…è€Œè¨€ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ¥è·å–ä¸€ä¸ªç›®çš„å¯¹è±¡çš„ç¼“å†²ï¼š</p>
<ul class="simple">
<li><p>ä½¿ç”¨æ­£ç¡®çš„å‚æ•°æ¥è°ƒç”¨ <a class="reference internal" href="#c.PyObject_GetBuffer" title="PyObject_GetBuffer"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_GetBuffer()</span></code></a> å‡½æ•°ï¼›</p></li>
<li><p>è°ƒç”¨ <a class="reference internal" href="arg.html#c.PyArg_ParseTuple" tppabs="https://docs.python.org/zh-cn/3/c-api/arg.html#c.PyArg_ParseTuple" title="PyArg_ParseTuple"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyArg_ParseTuple()</span></code></a> (æˆ–å…¶åŒçº§å¯¹è±¡ä¹‹ä¸€) å¹¶ä¼ å…¥ <code class="docutils literal notranslate"><span class="pre">y*</span></code>, <code class="docutils literal notranslate"><span class="pre">w*</span></code> or <code class="docutils literal notranslate"><span class="pre">s*</span></code> <a class="reference internal" href="arg.html#arg-parsing" tppabs="https://docs.python.org/zh-cn/3/c-api/arg.html#arg-parsing"><span class="std std-ref">æ ¼å¼ä»£ç </span></a> ä¸­çš„ä¸€ä¸ªã€‚</p></li>
</ul>
<p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå½“ä¸å†éœ€è¦ç¼“å†²åŒºæ—¶å¿…é¡»è°ƒç”¨ <a class="reference internal" href="#c.PyBuffer_Release" title="PyBuffer_Release"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyBuffer_Release()</span></code></a>Â ã€‚å¦‚æœæ­¤æ“ä½œå¤±è´¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´å„ç§é—®é¢˜ï¼Œä¾‹å¦‚èµ„æºæ³„æ¼ã€‚</p>
<div class="section" id="buffer-structure">
<span id="id1"></span><h2>ç¼“å†²åŒºç»“æ„<a class="headerlink" href="#buffer-structure" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>ç¼“å†²åŒºç»“æ„(æˆ–è€…ç®€å•åœ°ç§°ä¸ºâ€œbuffersâ€)å¯¹äºå°†äºŒè¿›åˆ¶æ•°æ®ä»å¦ä¸€ä¸ªå¯¹è±¡å…¬å¼€ç»™ Python ç¨‹åºå‘˜éå¸¸æœ‰ç”¨ã€‚å®ƒä»¬è¿˜å¯ä»¥ç”¨ä½œé›¶æ‹·è´åˆ‡ç‰‡æœºåˆ¶ã€‚ä½¿ç”¨å®ƒä»¬å¼•ç”¨å†…å­˜å—çš„èƒ½åŠ›ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°å°†ä»»ä½•æ•°æ®å…¬å¼€ç»™ Python ç¨‹åºå‘˜ã€‚å†…å­˜å¯ä»¥æ˜¯ C æ‰©å±•ä¸­çš„ä¸€ä¸ªå¤§çš„å¸¸é‡æ•°ç»„ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨ä¼ é€’åˆ°æ“ä½œç³»ç»Ÿåº“ä¹‹å‰ç”¨äºæ“ä½œçš„åŸå§‹å†…å­˜å—ï¼Œæˆ–è€…å¯ä»¥ç”¨æ¥ä¼ é€’æœ¬æœºå†…å­˜æ ¼å¼çš„ç»“æ„åŒ–æ•°æ®ã€‚</p>
<p>ä¸ Python è§£é‡Šå™¨å…¬å¼€çš„å¤§å¤šéƒ¨æ•°æ®ç±»å‹ä¸åŒï¼Œç¼“å†²åŒºä¸æ˜¯ <a class="reference internal" href="structures.html#c.PyObject" tppabs="https://docs.python.org/zh-cn/3/c-api/structures.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyObject</span></code></a> æŒ‡é’ˆè€Œæ˜¯ç®€å•çš„ C ç»“æ„ã€‚ è¿™ä½¿å¾—å®ƒä»¬å¯ä»¥éå¸¸ç®€å•åœ°åˆ›å»ºå’Œå¤åˆ¶ã€‚ å½“éœ€è¦ä¸ºç¼“å†²åŒºåŠ ä¸Šæ³›å‹åŒ…è£…å™¨æ—¶ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª <a class="reference internal" href="memoryview.html#memoryview-objects" tppabs="https://docs.python.org/zh-cn/3/c-api/memoryview.html#memoryview-objects"><span class="std std-ref">å†…å­˜è§†å›¾</span></a> å¯¹è±¡ã€‚</p>
<p>æœ‰å…³å¦‚ä½•ç¼–å†™å¹¶å¯¼å‡ºå¯¹è±¡çš„ç®€çŸ­è¯´æ˜ï¼Œè¯·å‚é˜… <a class="reference internal" href="typeobj.html#buffer-structs" tppabs="https://docs.python.org/zh-cn/3/c-api/typeobj.html#buffer-structs"><span class="std std-ref">ç¼“å†²åŒºå¯¹è±¡ç»“æ„</span></a>ã€‚ è¦è·å–ç¼“å†²åŒºå¯¹è±¡ï¼Œè¯·å‚é˜… <a class="reference internal" href="#c.PyObject_GetBuffer" title="PyObject_GetBuffer"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_GetBuffer()</span></code></a>ã€‚</p>
<dl class="type">
<dt id="c.Py_buffer">
<code class="sig-name descname">Py_buffer</code><a class="headerlink" href="#c.Py_buffer" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><dl class="member">
<dt id="c.Py_buffer.buf">
void *<code class="sig-name descname">buf</code><a class="headerlink" href="#c.Py_buffer.buf" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>æŒ‡å‘ç”±ç¼“å†²åŒºå­—æ®µæè¿°çš„é€»è¾‘ç»“æ„å¼€å§‹çš„æŒ‡é’ˆã€‚ è¿™å¯ä»¥æ˜¯å¯¼å‡ºç¨‹åºåº•å±‚ç‰©ç†å†…å­˜å—ä¸­çš„ä»»ä½•ä½ç½®ã€‚ ä¾‹å¦‚ï¼Œä½¿ç”¨è´Ÿçš„ <a class="reference internal" href="#c.Py_buffer.strides" title="Py_buffer.strides"><code class="xref c c-member docutils literal notranslate"><span class="pre">strides</span></code></a> å€¼å¯èƒ½æŒ‡å‘å†…å­˜å—çš„æœ«å°¾ã€‚</p>
<p>å¯¹äº <a class="reference internal" href="glossary.html#term-contiguous" tppabs="https://docs.python.org/zh-cn/3/glossary.html#term-contiguous"><span class="xref std std-term">contiguous</span></a> ï¼Œâ€˜é‚»æ¥â€™æ•°ç»„ï¼Œå€¼æŒ‡å‘å†…å­˜å—çš„å¼€å¤´ã€‚</p>
</dd></dl>

<dl class="member">
<dt id="c.Py_buffer.obj">
void *<code class="sig-name descname">obj</code><a class="headerlink" href="#c.Py_buffer.obj" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>å¯¹å¯¼å‡ºå¯¹è±¡çš„æ–°å¼•ç”¨ã€‚ è¯¥å¼•ç”¨å½’ä½¿ç”¨è€…æ‰€æœ‰ï¼Œå¹¶ç”± <a class="reference internal" href="#c.PyBuffer_Release" title="PyBuffer_Release"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyBuffer_Release()</span></code></a> è‡ªåŠ¨é€’å‡å¹¶è®¾ç½®ä¸º <code class="docutils literal notranslate"><span class="pre">NULL</span></code>ã€‚ è¯¥å­—æ®µç­‰äºä»»ä½•æ ‡å‡† C-API å‡½æ•°çš„è¿”å›å€¼ã€‚</p>
<p>ä½œä¸ºä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå¯¹äºç”± <a class="reference internal" href="memoryview.html#c.PyMemoryView_FromBuffer" tppabs="https://docs.python.org/zh-cn/3/c-api/memoryview.html#c.PyMemoryView_FromBuffer" title="PyMemoryView_FromBuffer"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyMemoryView_FromBuffer()</span></code></a> æˆ– <a class="reference internal" href="#c.PyBuffer_FillInfo" title="PyBuffer_FillInfo"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyBuffer_FillInfo()</span></code></a> åŒ…è£…çš„ <em>temporary</em> ç¼“å†²åŒºï¼Œæ­¤å­—æ®µä¸º <code class="docutils literal notranslate"><span class="pre">NULL</span></code>ã€‚ é€šå¸¸ï¼Œå¯¼å‡ºå¯¹è±¡ä¸å¾—ä½¿ç”¨æ­¤æ–¹æ¡ˆã€‚</p>
</dd></dl>

<dl class="member">
<dt id="c.Py_buffer.len">
Py_ssize_t <code class="sig-name descname">len</code><a class="headerlink" href="#c.Py_buffer.len" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">product(shape)</span> <span class="pre">*</span> <span class="pre">itemsize</span></code>ã€‚å¯¹äºè¿ç»­æ•°ç»„ï¼Œè¿™æ˜¯åŸºç¡€å†…å­˜å—çš„é•¿åº¦ã€‚å¯¹äºéè¿ç»­æ•°ç»„ï¼Œå¦‚æœé€»è¾‘ç»“æ„å¤åˆ¶åˆ°è¿ç»­è¡¨ç¤ºå½¢å¼ï¼Œåˆ™è¯¥é•¿åº¦å°†å…·æœ‰è¯¥é•¿åº¦ã€‚</p>
<p>ä»…å½“ç¼“å†²åŒºæ˜¯é€šè¿‡ä¿è¯è¿ç»­æ€§çš„è¯·æ±‚è·å–æ—¶ï¼Œæ‰è®¿é—® <code class="docutils literal notranslate"><span class="pre">((char</span> <span class="pre">*)buf)[0]</span> <span class="pre">up</span> <span class="pre">to</span> <span class="pre">((char</span> <span class="pre">*)buf)[len-1]</span></code> æ—¶æ‰æœ‰æ•ˆã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ­¤ç±»è¯·æ±‚å°†ä¸º <a class="reference internal" href="#c.PyBUF_SIMPLE" title="PyBUF_SIMPLE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_SIMPLE</span></code></a> æˆ– <a class="reference internal" href="#c.PyBUF_WRITABLE" title="PyBUF_WRITABLE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_WRITABLE</span></code></a>ã€‚</p>
</dd></dl>

<dl class="member">
<dt id="c.Py_buffer.readonly">
int <code class="sig-name descname">readonly</code><a class="headerlink" href="#c.Py_buffer.readonly" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>ç¼“å†²åŒºæ˜¯å¦ä¸ºåªè¯»çš„æŒ‡ç¤ºå™¨ã€‚æ­¤å­—æ®µç”± <a class="reference internal" href="#c.PyBUF_WRITABLE" title="PyBUF_WRITABLE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_WRITABLE</span></code></a> æ ‡å¿—æ§åˆ¶ã€‚</p>
</dd></dl>

<dl class="member">
<dt id="c.Py_buffer.itemsize">
Py_ssize_t <code class="sig-name descname">itemsize</code><a class="headerlink" href="#c.Py_buffer.itemsize" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>å•ä¸ªå…ƒç´ çš„é¡¹å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ä¸ <a class="reference internal" href="struct.html#struct.calcsize" tppabs="https://docs.python.org/zh-cn/3/library/struct.html#struct.calcsize" title="struct.calcsize"><code class="xref py py-func docutils literal notranslate"><span class="pre">struct.calcsize()</span></code></a> è°ƒç”¨é <code class="docutils literal notranslate"><span class="pre">NULL</span></code> <a class="reference internal" href="#c.Py_buffer.format" title="Py_buffer.format"><code class="xref c c-member docutils literal notranslate"><span class="pre">format</span></code></a> çš„å€¼ç›¸åŒã€‚</p>
<p>é‡è¦ä¾‹å¤–ï¼šå¦‚æœä½¿ç”¨è€…è¯·æ±‚çš„ç¼“å†²åŒºæ²¡æœ‰ <a class="reference internal" href="#c.PyBUF_FORMAT" title="PyBUF_FORMAT"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_FORMAT</span></code></a> æ ‡å¿—ï¼Œ<a class="reference internal" href="#c.Py_buffer.format" title="Py_buffer.format"><code class="xref c c-member docutils literal notranslate"><span class="pre">format</span></code></a> å°†è®¾ç½®ä¸º <code class="docutils literal notranslate"><span class="pre">NULL</span></code>ï¼Œä½† <a class="reference internal" href="#c.Py_buffer.itemsize" title="Py_buffer.itemsize"><code class="xref c c-member docutils literal notranslate"><span class="pre">itemsize</span></code></a> ä»å…·æœ‰åŸå§‹æ ¼å¼çš„å€¼ã€‚</p>
<p>å¦‚æœ <a class="reference internal" href="#c.Py_buffer.shape" title="Py_buffer.shape"><code class="xref c c-member docutils literal notranslate"><span class="pre">shape</span></code></a> å­˜åœ¨ï¼Œåˆ™ç›¸ç­‰çš„ <code class="docutils literal notranslate"><span class="pre">product(shape)</span> <span class="pre">*</span> <span class="pre">itemsize</span> <span class="pre">==</span> <span class="pre">len</span></code> ä»ç„¶å­˜åœ¨ï¼Œä½¿ç”¨è€…å¯ä»¥ä½¿ç”¨ <a class="reference internal" href="#c.Py_buffer.itemsize" title="Py_buffer.itemsize"><code class="xref c c-member docutils literal notranslate"><span class="pre">itemsize</span></code></a> æ¥å¯¼èˆªç¼“å†²åŒºã€‚</p>
<p>å¦‚æœ <a class="reference internal" href="#c.Py_buffer.shape" title="Py_buffer.shape"><code class="xref c c-member docutils literal notranslate"><span class="pre">shape</span></code></a> æ˜¯ <code class="docutils literal notranslate"><span class="pre">NULL</span></code>ï¼Œå› ä¸ºç»“æœä¸º <a class="reference internal" href="#c.PyBUF_SIMPLE" title="PyBUF_SIMPLE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_SIMPLE</span></code></a> æˆ– <a class="reference internal" href="#c.PyBUF_WRITABLE" title="PyBUF_WRITABLE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_WRITABLE</span></code></a> è¯·æ±‚ï¼Œåˆ™ä½¿ç”¨è€…å¿…é¡»å¿½ç•¥ <a class="reference internal" href="#c.Py_buffer.itemsize" title="Py_buffer.itemsize"><code class="xref c c-member docutils literal notranslate"><span class="pre">itemsize</span></code></a>ï¼Œå¹¶å‡è®¾ <code class="docutils literal notranslate"><span class="pre">itemsize</span> <span class="pre">==</span> <span class="pre">1</span></code>ã€‚</p>
</dd></dl>

<dl class="member">
<dt id="c.Py_buffer.format">
const char *<code class="sig-name descname">format</code><a class="headerlink" href="#c.Py_buffer.format" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>åœ¨ <a class="reference internal" href="struct.html#module-struct" tppabs="https://docs.python.org/zh-cn/3/library/struct.html#module-struct" title="struct: Interpret bytes as packed binary data."><code class="xref py py-mod docutils literal notranslate"><span class="pre">struct</span></code></a> æ¨¡å—æ ·å¼è¯­æ³•ä¸­ <em>NUL</em> å­—ç¬¦ä¸²ï¼Œæè¿°å•ä¸ªé¡¹çš„å†…å®¹ã€‚å¦‚æœè¿™æ˜¯ <code class="docutils literal notranslate"><span class="pre">NULL</span></code>ï¼Œåˆ™å‡å®šä¸º``&quot;B&quot;`` (æ— ç¬¦å·å­—èŠ‚) ã€‚</p>
<p>æ­¤å­—æ®µç”± <a class="reference internal" href="#c.PyBUF_FORMAT" title="PyBUF_FORMAT"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_FORMAT</span></code></a> æ ‡å¿—æ§åˆ¶ã€‚</p>
</dd></dl>

<dl class="member">
<dt id="c.Py_buffer.ndim">
int <code class="sig-name descname">ndim</code><a class="headerlink" href="#c.Py_buffer.ndim" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>The number of dimensions the memory represents as an n-dimensional array.
If it is <code class="docutils literal notranslate"><span class="pre">0</span></code>, <a class="reference internal" href="#c.Py_buffer.buf" title="Py_buffer.buf"><code class="xref c c-member docutils literal notranslate"><span class="pre">buf</span></code></a> points to a single item representing
a scalar. In this case, <a class="reference internal" href="#c.Py_buffer.shape" title="Py_buffer.shape"><code class="xref c c-member docutils literal notranslate"><span class="pre">shape</span></code></a>, <a class="reference internal" href="#c.Py_buffer.strides" title="Py_buffer.strides"><code class="xref c c-member docutils literal notranslate"><span class="pre">strides</span></code></a>
and <a class="reference internal" href="#c.Py_buffer.suboffsets" title="Py_buffer.suboffsets"><code class="xref c c-member docutils literal notranslate"><span class="pre">suboffsets</span></code></a> MUST be <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
<p>The macro <code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_MAX_NDIM</span></code> limits the maximum number of dimensions
to 64. Exporters MUST respect this limit, consumers of multi-dimensional
buffers SHOULD be able to handle up to <code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_MAX_NDIM</span></code> dimensions.</p>
</dd></dl>

<dl class="member">
<dt id="c.Py_buffer.shape">
Py_ssize_t *<code class="sig-name descname">shape</code><a class="headerlink" href="#c.Py_buffer.shape" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>An array of <code class="xref c c-type docutils literal notranslate"><span class="pre">Py_ssize_t</span></code> of length <a class="reference internal" href="#c.Py_buffer.ndim" title="Py_buffer.ndim"><code class="xref c c-member docutils literal notranslate"><span class="pre">ndim</span></code></a>
indicating the shape of the memory as an n-dimensional array. Note that
<code class="docutils literal notranslate"><span class="pre">shape[0]</span> <span class="pre">*</span> <span class="pre">...</span> <span class="pre">*</span> <span class="pre">shape[ndim-1]</span> <span class="pre">*</span> <span class="pre">itemsize</span></code> MUST be equal to
<a class="reference internal" href="#c.Py_buffer.len" title="Py_buffer.len"><code class="xref c c-member docutils literal notranslate"><span class="pre">len</span></code></a>.</p>
<p>Shape values are restricted to <code class="docutils literal notranslate"><span class="pre">shape[n]</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code>. The case
<code class="docutils literal notranslate"><span class="pre">shape[n]</span> <span class="pre">==</span> <span class="pre">0</span></code> requires special attention. See <a class="reference internal" href="#complex-arrays">complex arrays</a>
for further information.</p>
<p>The shape array is read-only for the consumer.</p>
</dd></dl>

<dl class="member">
<dt id="c.Py_buffer.strides">
Py_ssize_t *<code class="sig-name descname">strides</code><a class="headerlink" href="#c.Py_buffer.strides" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>An array of <code class="xref c c-type docutils literal notranslate"><span class="pre">Py_ssize_t</span></code> of length <a class="reference internal" href="#c.Py_buffer.ndim" title="Py_buffer.ndim"><code class="xref c c-member docutils literal notranslate"><span class="pre">ndim</span></code></a>
giving the number of bytes to skip to get to a new element in each
dimension.</p>
<p>Stride values can be any integer. For regular arrays, strides are
usually positive, but a consumer MUST be able to handle the case
<code class="docutils literal notranslate"><span class="pre">strides[n]</span> <span class="pre">&lt;=</span> <span class="pre">0</span></code>. See <a class="reference internal" href="#complex-arrays">complex arrays</a> for further information.</p>
<p>The strides array is read-only for the consumer.</p>
</dd></dl>

<dl class="member">
<dt id="c.Py_buffer.suboffsets">
Py_ssize_t *<code class="sig-name descname">suboffsets</code><a class="headerlink" href="#c.Py_buffer.suboffsets" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>An array of <code class="xref c c-type docutils literal notranslate"><span class="pre">Py_ssize_t</span></code> of length <a class="reference internal" href="#c.Py_buffer.ndim" title="Py_buffer.ndim"><code class="xref c c-member docutils literal notranslate"><span class="pre">ndim</span></code></a>.
If <code class="docutils literal notranslate"><span class="pre">suboffsets[n]</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code>, the values stored along the nth dimension are
pointers and the suboffset value dictates how many bytes to add to each
pointer after de-referencing. A suboffset value that is negative
indicates that no de-referencing should occur (striding in a contiguous
memory block).</p>
<p>If all suboffsets are negative (i.e. no de-referencing is needed), then
this field must be <code class="docutils literal notranslate"><span class="pre">NULL</span></code> (the default value).</p>
<p>This type of array representation is used by the Python Imaging Library
(PIL). See <a class="reference internal" href="#complex-arrays">complex arrays</a> for further information how to access elements
of such an array.</p>
<p>The suboffsets array is read-only for the consumer.</p>
</dd></dl>

<dl class="member">
<dt id="c.Py_buffer.internal">
void *<code class="sig-name descname">internal</code><a class="headerlink" href="#c.Py_buffer.internal" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>This is for use internally by the exporting object. For example, this
might be re-cast as an integer by the exporter and used to store flags
about whether or not the shape, strides, and suboffsets arrays must be
freed when the buffer is released. The consumer MUST NOT alter this
value.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="buffer-request-types">
<span id="id2"></span><h2>Buffer request types<a class="headerlink" href="#buffer-request-types" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>Buffers are usually obtained by sending a buffer request to an exporting
object via <a class="reference internal" href="#c.PyObject_GetBuffer" title="PyObject_GetBuffer"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_GetBuffer()</span></code></a>. Since the complexity of the logical
structure of the memory can vary drastically, the consumer uses the <em>flags</em>
argument to specify the exact buffer type it can handle.</p>
<p>All <a class="reference internal" href="#c.Py_buffer" title="Py_buffer"><code class="xref c c-data docutils literal notranslate"><span class="pre">Py_buffer</span></code></a> fields are unambiguously defined by the request
type.</p>
<div class="section" id="request-independent-fields">
<h3>request-independent fields<a class="headerlink" href="#request-independent-fields" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>The following fields are not influenced by <em>flags</em> and must always be filled in
with the correct values: <a class="reference internal" href="#c.Py_buffer.obj" title="Py_buffer.obj"><code class="xref c c-member docutils literal notranslate"><span class="pre">obj</span></code></a>, <a class="reference internal" href="#c.Py_buffer.buf" title="Py_buffer.buf"><code class="xref c c-member docutils literal notranslate"><span class="pre">buf</span></code></a>,
<a class="reference internal" href="#c.Py_buffer.len" title="Py_buffer.len"><code class="xref c c-member docutils literal notranslate"><span class="pre">len</span></code></a>, <a class="reference internal" href="#c.Py_buffer.itemsize" title="Py_buffer.itemsize"><code class="xref c c-member docutils literal notranslate"><span class="pre">itemsize</span></code></a>, <a class="reference internal" href="#c.Py_buffer.ndim" title="Py_buffer.ndim"><code class="xref c c-member docutils literal notranslate"><span class="pre">ndim</span></code></a>.</p>
</div>
<div class="section" id="readonly-format">
<h3>readonly, format<a class="headerlink" href="#readonly-format" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<blockquote>
<div><dl class="macro">
<dt id="c.PyBUF_WRITABLE">
<code class="sig-name descname">PyBUF_WRITABLE</code><a class="headerlink" href="#c.PyBUF_WRITABLE" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>Controls the <a class="reference internal" href="#c.Py_buffer.readonly" title="Py_buffer.readonly"><code class="xref c c-member docutils literal notranslate"><span class="pre">readonly</span></code></a> field. If set, the exporter
MUST provide a writable buffer or else report failure. Otherwise, the
exporter MAY provide either a read-only or writable buffer, but the choice
MUST be consistent for all consumers.</p>
</dd></dl>

<dl class="macro">
<dt id="c.PyBUF_FORMAT">
<code class="sig-name descname">PyBUF_FORMAT</code><a class="headerlink" href="#c.PyBUF_FORMAT" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>Controls the <a class="reference internal" href="#c.Py_buffer.format" title="Py_buffer.format"><code class="xref c c-member docutils literal notranslate"><span class="pre">format</span></code></a> field. If set, this field MUST
be filled in correctly. Otherwise, this field MUST be <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
</dd></dl>

</div></blockquote>
<p><a class="reference internal" href="#c.PyBUF_WRITABLE" title="PyBUF_WRITABLE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_WRITABLE</span></code></a> can be |'d to any of the flags in the next section.
Since <a class="reference internal" href="#c.PyBUF_SIMPLE" title="PyBUF_SIMPLE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_SIMPLE</span></code></a> is defined as 0, <a class="reference internal" href="#c.PyBUF_WRITABLE" title="PyBUF_WRITABLE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_WRITABLE</span></code></a>
can be used as a stand-alone flag to request a simple writable buffer.</p>
<p><a class="reference internal" href="#c.PyBUF_FORMAT" title="PyBUF_FORMAT"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_FORMAT</span></code></a> can be |'d to any of the flags except <a class="reference internal" href="#c.PyBUF_SIMPLE" title="PyBUF_SIMPLE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_SIMPLE</span></code></a>.
The latter already implies format <code class="docutils literal notranslate"><span class="pre">B</span></code> (unsigned bytes).</p>
</div>
<div class="section" id="shape-strides-suboffsets">
<h3>shape, strides, suboffsets<a class="headerlink" href="#shape-strides-suboffsets" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>The flags that control the logical structure of the memory are listed
in decreasing order of complexity. Note that each flag contains all bits
of the flags below it.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 51%" />
<col style="width: 12%" />
<col style="width: 16%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>è¯·æ±‚</p></th>
<th class="head"><p>å½¢çŠ¶</p></th>
<th class="head"><p>æ­¥å¹…</p></th>
<th class="head"><p>å­åç§»é‡</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><dl class="macro">
<dt id="c.PyBUF_INDIRECT">
<code class="sig-name descname">PyBUF_INDIRECT</code><a class="headerlink" href="#c.PyBUF_INDIRECT" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>æ˜¯</p></td>
<td><p>å¦‚æœéœ€è¦çš„è¯</p></td>
</tr>
<tr class="row-odd"><td><dl class="macro">
<dt id="c.PyBUF_STRIDES">
<code class="sig-name descname">PyBUF_STRIDES</code><a class="headerlink" href="#c.PyBUF_STRIDES" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>æ˜¯</p></td>
<td><p>NULL</p></td>
</tr>
<tr class="row-even"><td><dl class="macro">
<dt id="c.PyBUF_ND">
<code class="sig-name descname">PyBUF_ND</code><a class="headerlink" href="#c.PyBUF_ND" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>NULL</p></td>
<td><p>NULL</p></td>
</tr>
<tr class="row-odd"><td><dl class="macro">
<dt id="c.PyBUF_SIMPLE">
<code class="sig-name descname">PyBUF_SIMPLE</code><a class="headerlink" href="#c.PyBUF_SIMPLE" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>NULL</p></td>
<td><p>NULL</p></td>
<td><p>NULL</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="contiguity-requests">
<span id="index-2"></span><h3>è¿ç»­æ€§çš„è¯·æ±‚<a class="headerlink" href="#contiguity-requests" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>C or Fortran <a class="reference internal" href="glossary.html#term-contiguous" tppabs="https://docs.python.org/zh-cn/3/glossary.html#term-contiguous"><span class="xref std std-term">contiguity</span></a> can be explicitly requested,
with and without stride information. Without stride information, the buffer
must be C-contiguous.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 49%" />
<col style="width: 10%" />
<col style="width: 13%" />
<col style="width: 17%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>è¯·æ±‚</p></th>
<th class="head"><p>å½¢çŠ¶</p></th>
<th class="head"><p>æ­¥å¹…</p></th>
<th class="head"><p>å­åç§»é‡</p></th>
<th class="head"><p>é‚»æ¥</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><dl class="macro">
<dt id="c.PyBUF_C_CONTIGUOUS">
<code class="sig-name descname">PyBUF_C_CONTIGUOUS</code><a class="headerlink" href="#c.PyBUF_C_CONTIGUOUS" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>æ˜¯</p></td>
<td><p>NULL</p></td>
<td><p>C</p></td>
</tr>
<tr class="row-odd"><td><dl class="macro">
<dt id="c.PyBUF_F_CONTIGUOUS">
<code class="sig-name descname">PyBUF_F_CONTIGUOUS</code><a class="headerlink" href="#c.PyBUF_F_CONTIGUOUS" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>æ˜¯</p></td>
<td><p>NULL</p></td>
<td><p>F</p></td>
</tr>
<tr class="row-even"><td><dl class="macro">
<dt id="c.PyBUF_ANY_CONTIGUOUS">
<code class="sig-name descname">PyBUF_ANY_CONTIGUOUS</code><a class="headerlink" href="#c.PyBUF_ANY_CONTIGUOUS" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>æ˜¯</p></td>
<td><p>NULL</p></td>
<td><p>C æˆ– F</p></td>
</tr>
<tr class="row-odd"><td><dl class="macro">
<dt>
<code class="sig-name descname">PyBUF_ND</code></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>NULL</p></td>
<td><p>NULL</p></td>
<td><p>C</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="compound-requests">
<h3>å¤åˆè¯·æ±‚<a class="headerlink" href="#compound-requests" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>æ‰€æœ‰å¯èƒ½çš„è¯·æ±‚éƒ½ç”±ä¸Šä¸€èŠ‚ä¸­æŸäº›æ ‡å¿—çš„ç»„åˆå®Œå…¨å®šä¹‰ã€‚ä¸ºæ–¹ä¾¿èµ·è§ï¼Œç¼“å†²åŒºåè®®æä¾›å¸¸ç”¨çš„ç»„åˆä½œä¸ºå•ä¸ªæ ‡å¿—ã€‚</p>
<p>In the following table <em>U</em> stands for undefined contiguity. The consumer would
have to call <a class="reference internal" href="#c.PyBuffer_IsContiguous" title="PyBuffer_IsContiguous"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyBuffer_IsContiguous()</span></code></a> to determine contiguity.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 36%" />
<col style="width: 8%" />
<col style="width: 11%" />
<col style="width: 14%" />
<col style="width: 9%" />
<col style="width: 12%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>è¯·æ±‚</p></th>
<th class="head"><p>å½¢çŠ¶</p></th>
<th class="head"><p>æ­¥å¹…</p></th>
<th class="head"><p>å­åç§»é‡</p></th>
<th class="head"><p>é‚»æ¥</p></th>
<th class="head"><p>åªè¯»</p></th>
<th class="head"><p>æ ¼å¼</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><dl class="macro">
<dt id="c.PyBUF_FULL">
<code class="sig-name descname">PyBUF_FULL</code><a class="headerlink" href="#c.PyBUF_FULL" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>æ˜¯</p></td>
<td><p>å¦‚æœéœ€è¦çš„è¯</p></td>
<td><p>U</p></td>
<td><p>0</p></td>
<td><p>æ˜¯</p></td>
</tr>
<tr class="row-odd"><td><dl class="macro">
<dt id="c.PyBUF_FULL_RO">
<code class="sig-name descname">PyBUF_FULL_RO</code><a class="headerlink" href="#c.PyBUF_FULL_RO" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>æ˜¯</p></td>
<td><p>å¦‚æœéœ€è¦çš„è¯</p></td>
<td><p>U</p></td>
<td><p>1 æˆ– 0</p></td>
<td><p>æ˜¯</p></td>
</tr>
<tr class="row-even"><td><dl class="macro">
<dt id="c.PyBUF_RECORDS">
<code class="sig-name descname">PyBUF_RECORDS</code><a class="headerlink" href="#c.PyBUF_RECORDS" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>æ˜¯</p></td>
<td><p>NULL</p></td>
<td><p>U</p></td>
<td><p>0</p></td>
<td><p>æ˜¯</p></td>
</tr>
<tr class="row-odd"><td><dl class="macro">
<dt id="c.PyBUF_RECORDS_RO">
<code class="sig-name descname">PyBUF_RECORDS_RO</code><a class="headerlink" href="#c.PyBUF_RECORDS_RO" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>æ˜¯</p></td>
<td><p>NULL</p></td>
<td><p>U</p></td>
<td><p>1 æˆ– 0</p></td>
<td><p>æ˜¯</p></td>
</tr>
<tr class="row-even"><td><dl class="macro">
<dt id="c.PyBUF_STRIDED">
<code class="sig-name descname">PyBUF_STRIDED</code><a class="headerlink" href="#c.PyBUF_STRIDED" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>æ˜¯</p></td>
<td><p>NULL</p></td>
<td><p>U</p></td>
<td><p>0</p></td>
<td><p>NULL</p></td>
</tr>
<tr class="row-odd"><td><dl class="macro">
<dt id="c.PyBUF_STRIDED_RO">
<code class="sig-name descname">PyBUF_STRIDED_RO</code><a class="headerlink" href="#c.PyBUF_STRIDED_RO" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>æ˜¯</p></td>
<td><p>NULL</p></td>
<td><p>U</p></td>
<td><p>1 æˆ– 0</p></td>
<td><p>NULL</p></td>
</tr>
<tr class="row-even"><td><dl class="macro">
<dt id="c.PyBUF_CONTIG">
<code class="sig-name descname">PyBUF_CONTIG</code><a class="headerlink" href="#c.PyBUF_CONTIG" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>NULL</p></td>
<td><p>NULL</p></td>
<td><p>C</p></td>
<td><p>0</p></td>
<td><p>NULL</p></td>
</tr>
<tr class="row-odd"><td><dl class="macro">
<dt id="c.PyBUF_CONTIG_RO">
<code class="sig-name descname">PyBUF_CONTIG_RO</code><a class="headerlink" href="#c.PyBUF_CONTIG_RO" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd></dd></dl>

</td>
<td><p>æ˜¯</p></td>
<td><p>NULL</p></td>
<td><p>NULL</p></td>
<td><p>C</p></td>
<td><p>1 æˆ– 0</p></td>
<td><p>NULL</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="complex-arrays">
<h2>å¤æ‚æ•°ç»„<a class="headerlink" href="#complex-arrays" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<div class="section" id="numpy-style-shape-and-strides">
<h3>NumPy-style: shape and strides<a class="headerlink" href="#numpy-style-shape-and-strides" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>The logical structure of NumPy-style arrays is defined by <a class="reference internal" href="#c.Py_buffer.itemsize" title="Py_buffer.itemsize"><code class="xref c c-member docutils literal notranslate"><span class="pre">itemsize</span></code></a>,
<a class="reference internal" href="#c.Py_buffer.ndim" title="Py_buffer.ndim"><code class="xref c c-member docutils literal notranslate"><span class="pre">ndim</span></code></a>, <a class="reference internal" href="#c.Py_buffer.shape" title="Py_buffer.shape"><code class="xref c c-member docutils literal notranslate"><span class="pre">shape</span></code></a> and <a class="reference internal" href="#c.Py_buffer.strides" title="Py_buffer.strides"><code class="xref c c-member docutils literal notranslate"><span class="pre">strides</span></code></a>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">ndim</span> <span class="pre">==</span> <span class="pre">0</span></code>, the memory location pointed to by <a class="reference internal" href="#c.Py_buffer.buf" title="Py_buffer.buf"><code class="xref c c-member docutils literal notranslate"><span class="pre">buf</span></code></a> is
interpreted as a scalar of size <a class="reference internal" href="#c.Py_buffer.itemsize" title="Py_buffer.itemsize"><code class="xref c c-member docutils literal notranslate"><span class="pre">itemsize</span></code></a>. In that case,
both <a class="reference internal" href="#c.Py_buffer.shape" title="Py_buffer.shape"><code class="xref c c-member docutils literal notranslate"><span class="pre">shape</span></code></a> and <a class="reference internal" href="#c.Py_buffer.strides" title="Py_buffer.strides"><code class="xref c c-member docutils literal notranslate"><span class="pre">strides</span></code></a> are <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
<p>If <a class="reference internal" href="#c.Py_buffer.strides" title="Py_buffer.strides"><code class="xref c c-member docutils literal notranslate"><span class="pre">strides</span></code></a> is <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, the array is interpreted as
a standard n-dimensional C-array. Otherwise, the consumer must access an
n-dimensional array as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">buf</span> <span class="o">+</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">...</span> <span class="o">+</span> <span class="n">indices</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
<span class="n">item</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">typeof</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">*</span><span class="p">)</span><span class="n">ptr</span><span class="p">);</span>
</pre></div>
</div>
<p>As noted above, <a class="reference internal" href="#c.Py_buffer.buf" title="Py_buffer.buf"><code class="xref c c-member docutils literal notranslate"><span class="pre">buf</span></code></a> can point to any location within
the actual memory block. An exporter can check the validity of a buffer with
this function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">verify_structure</span><span class="p">(</span><span class="n">memlen</span><span class="p">,</span> <span class="n">itemsize</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">strides</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Verify that the parameters represent a valid array within</span>
<span class="sd">       the bounds of the allocated memory:</span>
<span class="sd">           char *mem: start of the physical memory block</span>
<span class="sd">           memlen: length of the physical memory block</span>
<span class="sd">           offset: (char *)buf - mem</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">offset</span> <span class="o">%</span> <span class="n">itemsize</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">offset</span><span class="o">+</span><span class="n">itemsize</span> <span class="o">&gt;</span> <span class="n">memlen</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">v</span> <span class="o">%</span> <span class="n">itemsize</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">strides</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">shape</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">strides</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="n">imin</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">strides</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
               <span class="k">if</span> <span class="n">strides</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">imax</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">strides</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
               <span class="k">if</span> <span class="n">strides</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">offset</span><span class="o">+</span><span class="n">imin</span> <span class="ow">and</span> <span class="n">offset</span><span class="o">+</span><span class="n">imax</span><span class="o">+</span><span class="n">itemsize</span> <span class="o">&lt;=</span> <span class="n">memlen</span>
</pre></div>
</div>
</div>
<div class="section" id="pil-style-shape-strides-and-suboffsets">
<h3>PIL-style: shape, strides and suboffsets<a class="headerlink" href="#pil-style-shape-strides-and-suboffsets" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>In addition to the regular items, PIL-style arrays can contain pointers
that must be followed in order to get to the next element in a dimension.
For example, the regular three-dimensional C-array <code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">v[2][2][3]</span></code> can
also be viewed as an array of 2 pointers to 2 two-dimensional arrays:
<code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">(*v[2])[2][3]</span></code>. In suboffsets representation, those two pointers
can be embedded at the start of <a class="reference internal" href="#c.Py_buffer.buf" title="Py_buffer.buf"><code class="xref c c-member docutils literal notranslate"><span class="pre">buf</span></code></a>, pointing
to two <code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">x[2][3]</span></code> arrays that can be located anywhere in memory.</p>
<p>Here is a function that returns a pointer to the element in an N-D array
pointed to by an N-dimensional index when there are both non-<code class="docutils literal notranslate"><span class="pre">NULL</span></code> strides
and suboffsets:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="o">*</span><span class="nf">get_item_pointer</span><span class="p">(</span><span class="kt">int</span> <span class="n">ndim</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">Py_ssize_t</span> <span class="o">*</span><span class="n">strides</span><span class="p">,</span>
                       <span class="n">Py_ssize_t</span> <span class="o">*</span><span class="n">suboffsets</span><span class="p">,</span> <span class="n">Py_ssize_t</span> <span class="o">*</span><span class="n">indices</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">pointer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">buf</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ndim</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pointer</span> <span class="o">+=</span> <span class="n">strides</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">suboffsets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">pointer</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">char</span><span class="o">**</span><span class="p">)</span><span class="n">pointer</span><span class="p">)</span> <span class="o">+</span> <span class="n">suboffsets</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">pointer</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="buffer-related-functions">
<h2>Buffer-related functions<a class="headerlink" href="#buffer-related-functions" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<dl class="function">
<dt id="c.PyObject_CheckBuffer">
int <code class="sig-name descname">PyObject_CheckBuffer</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" tppabs="https://docs.python.org/zh-cn/3/c-api/structures.html#c.PyObject" title="PyObject">PyObject</a><em>Â *obj</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyObject_CheckBuffer" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">1</span></code> if <em>obj</em> supports the buffer interface otherwise <code class="docutils literal notranslate"><span class="pre">0</span></code>.  When <code class="docutils literal notranslate"><span class="pre">1</span></code> is
returned, it doesn't guarantee that <a class="reference internal" href="#c.PyObject_GetBuffer" title="PyObject_GetBuffer"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_GetBuffer()</span></code></a> will
succeed.  This function always succeeds.</p>
</dd></dl>

<dl class="function">
<dt id="c.PyObject_GetBuffer">
int <code class="sig-name descname">PyObject_GetBuffer</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" tppabs="https://docs.python.org/zh-cn/3/c-api/structures.html#c.PyObject" title="PyObject">PyObject</a><em>Â *exporter</em>, <a class="reference internal" href="#c.Py_buffer" title="Py_buffer">Py_buffer</a><em>Â *view</em>, int<em>Â flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyObject_GetBuffer" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>Send a request to <em>exporter</em> to fill in <em>view</em> as specified by  <em>flags</em>.
If the exporter cannot provide a buffer of the exact type, it MUST raise
<code class="xref c c-data docutils literal notranslate"><span class="pre">PyExc_BufferError</span></code>, set <code class="xref c c-member docutils literal notranslate"><span class="pre">view-&gt;obj</span></code> to <code class="docutils literal notranslate"><span class="pre">NULL</span></code> and
return <code class="docutils literal notranslate"><span class="pre">-1</span></code>.</p>
<p>On success, fill in <em>view</em>, set <code class="xref c c-member docutils literal notranslate"><span class="pre">view-&gt;obj</span></code> to a new reference
to <em>exporter</em> and return 0. In the case of chained buffer providers
that redirect requests to a single object, <code class="xref c c-member docutils literal notranslate"><span class="pre">view-&gt;obj</span></code> MAY
refer to this object instead of <em>exporter</em> (See <a class="reference internal" href="typeobj.html#buffer-structs" tppabs="https://docs.python.org/zh-cn/3/c-api/typeobj.html#buffer-structs"><span class="std std-ref">Buffer Object Structures</span></a>).</p>
<p>Successful calls to <a class="reference internal" href="#c.PyObject_GetBuffer" title="PyObject_GetBuffer"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_GetBuffer()</span></code></a> must be paired with calls
to <a class="reference internal" href="#c.PyBuffer_Release" title="PyBuffer_Release"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyBuffer_Release()</span></code></a>, similar to <code class="xref c c-func docutils literal notranslate"><span class="pre">malloc()</span></code> and <code class="xref c c-func docutils literal notranslate"><span class="pre">free()</span></code>.
Thus, after the consumer is done with the buffer, <a class="reference internal" href="#c.PyBuffer_Release" title="PyBuffer_Release"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyBuffer_Release()</span></code></a>
must be called exactly once.</p>
</dd></dl>

<dl class="function">
<dt id="c.PyBuffer_Release">
void <code class="sig-name descname">PyBuffer_Release</code><span class="sig-paren">(</span><a class="reference internal" href="#c.Py_buffer" title="Py_buffer">Py_buffer</a><em>Â *view</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyBuffer_Release" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>Release the buffer <em>view</em> and decrement the reference count for
<code class="xref c c-member docutils literal notranslate"><span class="pre">view-&gt;obj</span></code>. This function MUST be called when the buffer
is no longer being used, otherwise reference leaks may occur.</p>
<p>It is an error to call this function on a buffer that was not obtained via
<a class="reference internal" href="#c.PyObject_GetBuffer" title="PyObject_GetBuffer"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_GetBuffer()</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt id="c.PyBuffer_SizeFromFormat">
Py_ssize_t <code class="sig-name descname">PyBuffer_SizeFromFormat</code><span class="sig-paren">(</span>const char<em>Â *</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyBuffer_SizeFromFormat" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>Return the implied <a class="reference internal" href="#c.Py_buffer.itemsize" title="Py_buffer.itemsize"><code class="xref c c-data docutils literal notranslate"><span class="pre">itemsize</span></code></a> from <a class="reference internal" href="#c.Py_buffer.format" title="Py_buffer.format"><code class="xref c c-data docutils literal notranslate"><span class="pre">format</span></code></a>.
This function is not yet implemented.</p>
</dd></dl>

<dl class="function">
<dt id="c.PyBuffer_IsContiguous">
int <code class="sig-name descname">PyBuffer_IsContiguous</code><span class="sig-paren">(</span><a class="reference internal" href="#c.Py_buffer" title="Py_buffer">Py_buffer</a><em>Â *view</em>, char<em>Â order</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyBuffer_IsContiguous" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">1</span></code> if the memory defined by the <em>view</em> is C-style (<em>order</em> is
<code class="docutils literal notranslate"><span class="pre">'C'</span></code>) or Fortran-style (<em>order</em> is <code class="docutils literal notranslate"><span class="pre">'F'</span></code>) <a class="reference internal" href="glossary.html#term-contiguous" tppabs="https://docs.python.org/zh-cn/3/glossary.html#term-contiguous"><span class="xref std std-term">contiguous</span></a> or either one
(<em>order</em> is <code class="docutils literal notranslate"><span class="pre">'A'</span></code>).  Return <code class="docutils literal notranslate"><span class="pre">0</span></code> otherwise.  This function always succeeds.</p>
</dd></dl>

<dl class="function">
<dt id="c.PyBuffer_GetPointer">
void* <code class="sig-name descname">PyBuffer_GetPointer</code><span class="sig-paren">(</span><a class="reference internal" href="#c.Py_buffer" title="Py_buffer">Py_buffer</a><em>Â *view</em>, Py_ssize_t<em>Â *indices</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyBuffer_GetPointer" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>Get the memory area pointed to by the <em>indices</em> inside the given <em>view</em>.
<em>indices</em> must point to an array of <code class="docutils literal notranslate"><span class="pre">view-&gt;ndim</span></code> indices.</p>
</dd></dl>

<dl class="function">
<dt id="c.PyBuffer_FromContiguous">
int <code class="sig-name descname">PyBuffer_FromContiguous</code><span class="sig-paren">(</span><a class="reference internal" href="#c.Py_buffer" title="Py_buffer">Py_buffer</a><em>Â *view</em>, void<em>Â *buf</em>, Py_ssize_t<em>Â len</em>, char<em>Â fort</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyBuffer_FromContiguous" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>Copy contiguous <em>len</em> bytes from <em>buf</em> to <em>view</em>.
<em>fort</em> can be <code class="docutils literal notranslate"><span class="pre">'C'</span></code> or <code class="docutils literal notranslate"><span class="pre">'F'</span></code> (for C-style or Fortran-style ordering).
<code class="docutils literal notranslate"><span class="pre">0</span></code> is returned on success, <code class="docutils literal notranslate"><span class="pre">-1</span></code> on error.</p>
</dd></dl>

<dl class="function">
<dt id="c.PyBuffer_ToContiguous">
int <code class="sig-name descname">PyBuffer_ToContiguous</code><span class="sig-paren">(</span>void<em>Â *buf</em>, <a class="reference internal" href="#c.Py_buffer" title="Py_buffer">Py_buffer</a><em>Â *src</em>, Py_ssize_t<em>Â len</em>, char<em>Â order</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyBuffer_ToContiguous" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>Copy <em>len</em> bytes from <em>src</em> to its contiguous representation in <em>buf</em>.
<em>order</em> can be <code class="docutils literal notranslate"><span class="pre">'C'</span></code> or <code class="docutils literal notranslate"><span class="pre">'F'</span></code> or <code class="docutils literal notranslate"><span class="pre">'A'</span></code> (for C-style or Fortran-style
ordering or either one). <code class="docutils literal notranslate"><span class="pre">0</span></code> is returned on success, <code class="docutils literal notranslate"><span class="pre">-1</span></code> on error.</p>
<p>This function fails if <em>len</em> != <em>src-&gt;len</em>.</p>
</dd></dl>

<dl class="function">
<dt id="c.PyBuffer_FillContiguousStrides">
void <code class="sig-name descname">PyBuffer_FillContiguousStrides</code><span class="sig-paren">(</span>int<em>Â ndims</em>, Py_ssize_t<em>Â *shape</em>, Py_ssize_t<em>Â *strides</em>, int<em>Â itemsize</em>, char<em>Â order</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyBuffer_FillContiguousStrides" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>Fill the <em>strides</em> array with byte-strides of a <a class="reference internal" href="glossary.html#term-contiguous" tppabs="https://docs.python.org/zh-cn/3/glossary.html#term-contiguous"><span class="xref std std-term">contiguous</span></a> (C-style if
<em>order</em> is <code class="docutils literal notranslate"><span class="pre">'C'</span></code> or Fortran-style if <em>order</em> is <code class="docutils literal notranslate"><span class="pre">'F'</span></code>) array of the
given shape with the given number of bytes per element.</p>
</dd></dl>

<dl class="function">
<dt id="c.PyBuffer_FillInfo">
int <code class="sig-name descname">PyBuffer_FillInfo</code><span class="sig-paren">(</span><a class="reference internal" href="#c.Py_buffer" title="Py_buffer">Py_buffer</a><em>Â *view</em>, <a class="reference internal" href="structures.html#c.PyObject" tppabs="https://docs.python.org/zh-cn/3/c-api/structures.html#c.PyObject" title="PyObject">PyObject</a><em>Â *exporter</em>, void<em>Â *buf</em>, Py_ssize_t<em>Â len</em>, int<em>Â readonly</em>, int<em>Â flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyBuffer_FillInfo" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>Handle buffer requests for an exporter that wants to expose <em>buf</em> of size <em>len</em>
with writability set according to <em>readonly</em>. <em>buf</em> is interpreted as a sequence
of unsigned bytes.</p>
<p>The <em>flags</em> argument indicates the request type. This function always fills in
<em>view</em> as specified by flags, unless <em>buf</em> has been designated as read-only
and <a class="reference internal" href="#c.PyBUF_WRITABLE" title="PyBUF_WRITABLE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyBUF_WRITABLE</span></code></a> is set in <em>flags</em>.</p>
<p>On success, set <code class="xref c c-member docutils literal notranslate"><span class="pre">view-&gt;obj</span></code> to a new reference to <em>exporter</em> and
return 0. Otherwise, raise <code class="xref c c-data docutils literal notranslate"><span class="pre">PyExc_BufferError</span></code>, set
<code class="xref c c-member docutils literal notranslate"><span class="pre">view-&gt;obj</span></code> to <code class="docutils literal notranslate"><span class="pre">NULL</span></code> and return <code class="docutils literal notranslate"><span class="pre">-1</span></code>;</p>
<p>å¦‚æœæ­¤å‡½æ•°ç”¨ä½œ <a class="reference internal" href="typeobj.html#buffer-structs" tppabs="https://docs.python.org/zh-cn/3/c-api/typeobj.html#buffer-structs"><span class="std std-ref">getbufferproc</span></a> çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™ <em>exporter</em> å¿…é¡»è®¾ç½®ä¸ºå¯¼å‡ºå¯¹è±¡ï¼Œå¹¶ä¸”å¿…é¡»åœ¨æœªä¿®æ”¹çš„æƒ…å†µä¸‹ä¼ é€’ <em>flags</em>ã€‚å¦åˆ™ï¼Œ<em>exporter</em> å¿…é¡»æ˜¯ <code class="docutils literal notranslate"><span class="pre">NULL</span></code>ã€‚</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="contents.html" tppabs="https://docs.python.org/zh-cn/3/contents.html">ç›®å½•</a></h3>
  <ul>
<li><a class="reference internal" href="#">ç¼“å†²åè®®</a><ul>
<li><a class="reference internal" href="#buffer-structure">ç¼“å†²åŒºç»“æ„</a></li>
<li><a class="reference internal" href="#buffer-request-types">Buffer request types</a><ul>
<li><a class="reference internal" href="#request-independent-fields">request-independent fields</a></li>
<li><a class="reference internal" href="#readonly-format">readonly, format</a></li>
<li><a class="reference internal" href="#shape-strides-suboffsets">shape, strides, suboffsets</a></li>
<li><a class="reference internal" href="#contiguity-requests">è¿ç»­æ€§çš„è¯·æ±‚</a></li>
<li><a class="reference internal" href="#compound-requests">å¤åˆè¯·æ±‚</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complex-arrays">å¤æ‚æ•°ç»„</a><ul>
<li><a class="reference internal" href="#numpy-style-shape-and-strides">NumPy-style: shape and strides</a></li>
<li><a class="reference internal" href="#pil-style-shape-strides-and-suboffsets">PIL-style: shape, strides and suboffsets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#buffer-related-functions">Buffer-related functions</a></li>
</ul>
</li>
</ul>

  <h4>ä¸Šä¸€ä¸ªä¸»é¢˜</h4>
  <p class="topless"><a href="iter.html" tppabs="https://docs.python.org/zh-cn/3/c-api/iter.html"
                        title="ä¸Šä¸€ç« ">è¿­ä»£å™¨åè®®</a></p>
  <h4>ä¸‹ä¸€ä¸ªä¸»é¢˜</h4>
  <p class="topless"><a href="objbuffer.html" tppabs="https://docs.python.org/zh-cn/3/c-api/objbuffer.html"
                        title="ä¸‹ä¸€ç« ">æ—§ç¼“å†²åè®®</a></p>
  <div role="note" aria-label="source link">
    <h3>æœ¬é¡µ</h3>
    <ul class="this-page-menu">
      <li><a href="bugs.html" tppabs="https://docs.python.org/zh-cn/3/bugs.html">æäº¤ Bug</a></li>
      <li>
        <a href="javascript:if(confirm('https://github.com/python/cpython/blob/3.8/Doc/c-api/buffer.rst  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://github.com/python/cpython/blob/3.8/Doc/c-api/buffer.rst'" tppabs="https://github.com/python/cpython/blob/3.8/Doc/c-api/buffer.rst"
            rel="nofollow">æ˜¾ç¤ºæºä»£ç 
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>å¯¼èˆª</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" tppabs="https://docs.python.org/zh-cn/3/genindex.html" title="æ€»ç›®å½•"
             >ç´¢å¼•</a></li>
        <li class="right" >
          <a href="py-modindex.html" tppabs="https://docs.python.org/zh-cn/3/py-modindex.html" title="Python æ¨¡å—ç´¢å¼•"
             >æ¨¡å—</a> |</li>
        <li class="right" >
          <a href="objbuffer.html" tppabs="https://docs.python.org/zh-cn/3/c-api/objbuffer.html" title="æ—§ç¼“å†²åè®®"
             >ä¸‹ä¸€é¡µ</a> |</li>
        <li class="right" >
          <a href="iter.html" tppabs="https://docs.python.org/zh-cn/3/c-api/iter.html" title="è¿­ä»£å™¨åè®®"
             >ä¸Šä¸€é¡µ</a> |</li>

    <li><img src="py.png" tppabs="https://docs.python.org/zh-cn/3/_static/py.png" alt=""
             style="vertical-align: middle; margin-top: -1px"/></li>
    <li><a href="javascript:if(confirm('https://www.python.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.python.org/'" tppabs="https://www.python.org/">Python</a> &#187;</li>
    

    <li>
      <span class="language_switcher_placeholder">zh_CN</span>
      <span class="version_switcher_placeholder">3.8.2</span>
      <a href="index-11.html" tppabs="https://docs.python.org/zh-cn/3/index.html">æ–‡æ¡£</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index-9.html" tppabs="https://docs.python.org/zh-cn/3/c-api/index.html" >Python/C API å‚è€ƒæ‰‹å†Œ</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="abstract.html" tppabs="https://docs.python.org/zh-cn/3/c-api/abstract.html" >æŠ½è±¡å¯¹è±¡å±‚</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="https://docs.python.org/zh-cn/3/search.html" method="get">
          <input placeholder="å¿«é€Ÿæœç´¢" type="text" name="q" />
          <input type="submit" value="è½¬å‘" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="copyright.html" tppabs="https://docs.python.org/zh-cn/3/copyright.html">ç‰ˆæƒæ‰€æœ‰</a> 2001-2020, Python Software Foundation.
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="javascript:if(confirm('https://www.python.org/psf/donations/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.python.org/psf/donations/'" tppabs="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    æœ€åæ›´æ–°äº 3æœˆ 26, 2020.
    <a href="javascript:if(confirm('https://docs.python.org/3/bugs.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://docs.python.org/3/bugs.html'" tppabs="https://docs.python.org/3/bugs.html">Found a bug</a>?
    <br />

    Created using <a href="javascript:if(confirm('https://www.sphinx-doc.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.sphinx-doc.org/'" tppabs="https://www.sphinx-doc.org/">Sphinx</a> 2.3.1.
    </div>

  </body>
</html>