
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>å°†æ‰©å±•æ¨¡å—ç§»æ¤åˆ° Python 3 &#8212; Python 3.7.3 æ–‡æ¡£</title>
    <link rel="stylesheet" href="pydoctheme.css" tppabs="https://docs.python.org/zh-cn/3/_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="pygments.css" tppabs="https://docs.python.org/zh-cn/3/_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="documentation_options.js" tppabs="https://docs.python.org/zh-cn/3/_static/documentation_options.js"></script>
    <script type="text/javascript" src="jquery.js" tppabs="https://docs.python.org/zh-cn/3/_static/jquery.js"></script>
    <script type="text/javascript" src="underscore.js" tppabs="https://docs.python.org/zh-cn/3/_static/underscore.js"></script>
    <script type="text/javascript" src="doctools.js" tppabs="https://docs.python.org/zh-cn/3/_static/doctools.js"></script>
    <script type="text/javascript" src="language_data.js" tppabs="https://docs.python.org/zh-cn/3/_static/language_data.js"></script>
    <script type="text/javascript" src="translations.js" tppabs="https://docs.python.org/zh-cn/3/_static/translations.js"></script>
    
    <script type="text/javascript" src="sidebar.js" tppabs="https://docs.python.org/zh-cn/3/_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="åœ¨ Python 3.7.3 æ–‡æ¡£ ä¸­æœç´¢"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="å…³äºè¿™äº›æ–‡æ¡£" href="../about.html" />
    <link rel="index" title="ç´¢å¼•" href="../genindex.html" />
    <link rel="search" title="æœç´¢" href="../search.html" />
    <link rel="copyright" title="ç‰ˆæƒæ‰€æœ‰" href="../copyright.html" />
    <link rel="next" title="Curses Programming with Python" href="curses.html" />
    <link rel="prev" title="å°† Python 2 ä»£ç è¿ç§»åˆ° Python 3" href="pyporting.html" />
    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    <link rel="canonical" href="https://docs.python.org/3/howto/cporting.html" />
    
    <script type="text/javascript" src="copybutton.js" tppabs="https://docs.python.org/zh-cn/3/_static/copybutton.js"></script>
    <script type="text/javascript" src="switchers.js" tppabs="https://docs.python.org/zh-cn/3/_static/switchers.js"></script>
    
    
    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
 

  </head><body>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>å¯¼èˆª</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" tppabs="https://docs.python.org/zh-cn/3/genindex.html" title="æ€»ç›®å½•"
             accesskey="I">ç´¢å¼•</a></li>
        <li class="right" >
          <a href="py-modindex.html" tppabs="https://docs.python.org/zh-cn/3/py-modindex.html" title="Python æ¨¡å—ç´¢å¼•"
             >æ¨¡å—</a> |</li>
        <li class="right" >
          <a href="curses-1.html" tppabs="https://docs.python.org/zh-cn/3/howto/curses.html" title="Curses Programming with Python"
             accesskey="N">ä¸‹ä¸€é¡µ</a> |</li>
        <li class="right" >
          <a href="pyporting.html" tppabs="https://docs.python.org/zh-cn/3/howto/pyporting.html" title="å°† Python 2 ä»£ç è¿ç§»åˆ° Python 3"
             accesskey="P">ä¸Šä¸€é¡µ</a> |</li>
        <li><img src="py.png" tppabs="https://docs.python.org/zh-cn/3/_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="javascript:if(confirm('https://www.python.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.python.org/'" tppabs="https://www.python.org/">Python</a> &#187;</li>
        <li>
          <span class="language_switcher_placeholder">zh_CN</span>
          <span class="version_switcher_placeholder">3.7.3</span>
          <a href="index-11.html" tppabs="https://docs.python.org/zh-cn/3/index.html">æ–‡æ¡£</a> &#187;
        </li>

          <li class="nav-item nav-item-1"><a href="index-5.html" tppabs="https://docs.python.org/zh-cn/3/howto/index.html" accesskey="U">Python å¸¸ç”¨æŒ‡å¼•</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="https://docs.python.org/zh-cn/3/search.html" method="get">
          <input placeholder="å¿«é€Ÿæœç´¢" type="text" name="q" />
          <input type="submit" value="è½¬å‘" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="porting-extension-modules-to-python-3">
<span id="cporting-howto"></span><h1>å°†æ‰©å±•æ¨¡å—ç§»æ¤åˆ° Python 3<a class="headerlink" href="#porting-extension-modules-to-python-3" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">ä½œè€…:</th><td class="field-body">Benjamin Peterson</td>
</tr>
</tbody>
</table>
<div class="topic">
<p class="topic-title first">æ‘˜è¦</p>
<p>å°½ç®¡æ›´æ”¹ C-API å¹¶ä¸æ˜¯ Python 3 çš„ç›®æ ‡ä¹‹ä¸€ï¼Œä½†è®¸å¤š Python çº§åˆ«çš„æ›´æ”¹ä½¿å¾— Python 2 çš„ API æ— æ³•å®Œæ•´å®ç°ã€‚å®é™…ä¸Šï¼Œä¸€äº›å˜åŒ–å¦‚ <a class="reference internal" href="functions.html#int" tppabs="https://docs.python.org/zh-cn/3/library/functions.html#int" title="int"><code class="xref py py-func docutils literal notranslate"><span class="pre">int()</span></code></a> å’Œ <code class="xref py py-func docutils literal notranslate"><span class="pre">long()</span></code>&nbsp;çš„ç»Ÿä¸€åœ¨ C çº§åˆ«æ›´æ˜æ˜¾ã€‚æœ¬æ–‡æ¡£è‡´åŠ›äºè®°å½•ä¸å…¼å®¹æ€§ä»¥åŠå¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ã€‚</p>
</div>
<div class="section" id="conditional-compilation">
<h2>æ¡ä»¶ç¼–è¯‘<a class="headerlink" href="#conditional-compilation" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>ä»…ç¼–è¯‘ Python 3 çš„ä¸€äº›ä»£ç çš„æœ€ç®€å•æ–¹æ³•æ˜¯æ£€æŸ¥ <code class="xref c c-macro docutils literal notranslate"><span class="pre">PY_MAJOR_VERSION</span></code> æ˜¯å¦å¤§äºæˆ–ç­‰äº3ã€‚</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#if PY_MAJOR_VERSION &gt;= 3</span>
<span class="cp">#define IS_PY3K</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>ä¸å­˜åœ¨çš„ API å‡½æ•°å¯ä»¥åœ¨æ¡ä»¶å—ä¸­åˆ«åä¸ºå®ƒä»¬çš„ç­‰ä»·ç‰©ã€‚</p>
</div>
<div class="section" id="changes-to-object-apis">
<h2>å¯¹è±¡APIçš„æ›´æ”¹<a class="headerlink" href="#changes-to-object-apis" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>Python 3 å°†ä¸€äº›å…·æœ‰ç±»ä¼¼åŠŸèƒ½çš„ç±»å‹åˆå¹¶åœ¨ä¸€èµ·ï¼ŒåŒæ—¶å¹²å‡€åœ°åˆ†ç¦»äº†å…¶ä»–ç±»å‹ã€‚</p>
<div class="section" id="str-unicode-unification">
<h3>str/unicode ç»Ÿä¸€<a class="headerlink" href="#str-unicode-unification" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>Python 3 çš„ <a class="reference internal" href="stdtypes.html#str" tppabs="https://docs.python.org/zh-cn/3/library/stdtypes.html#str" title="str"><code class="xref py py-func docutils literal notranslate"><span class="pre">str()</span></code></a> ç±»å‹ç›¸å½“äº Python 2 çš„ <code class="xref py py-func docutils literal notranslate"><span class="pre">unicode()</span></code> ï¼› Cå‡½æ•°è¢«ç§°ä¸º <code class="docutils literal notranslate"><span class="pre">PyUnicode_*</span></code> ã€‚æ—§çš„ 8 ä½å­—ç¬¦ä¸²ç±»å‹å˜ä¸º <a class="reference internal" href="stdtypes.html#bytes" tppabs="https://docs.python.org/zh-cn/3/library/stdtypes.html#bytes" title="bytes"><code class="xref py py-func docutils literal notranslate"><span class="pre">bytes()</span></code></a> ï¼Œå…¶ä¸­ C å‡½æ•°ç§°ä¸º <code class="docutils literal notranslate"><span class="pre">PyBytes_*</span></code> ã€‚ Python 2.6 åŠæ›´é«˜ç‰ˆæœ¬æä¾›äº†ä¸€ä¸ªå…¼å®¹æ€§å¤´æ–‡ä»¶ <code class="file docutils literal notranslate"><span class="pre">bytesobject.h</span></code> ï¼Œå°† <code class="docutils literal notranslate"><span class="pre">PyBytes</span></code> åç§°æ˜ å°„åˆ° <code class="docutils literal notranslate"><span class="pre">PyString</span></code> ã€‚ ä¸ºäº†ä¿æŒä¸ Python 3 çš„æœ€ä½³å…¼å®¹æ€§ï¼Œ <code class="xref c c-type docutils literal notranslate"><span class="pre">PyUnicode</span></code> åº”è¯¥ç”¨äºæ–‡æœ¬æ•°æ®ï¼Œå¹¶ä¸” <code class="xref c c-type docutils literal notranslate"><span class="pre">PyBytes</span></code> ç”¨äºäºŒè¿›åˆ¶æ•°æ®ã€‚åŒæ ·é‡è¦çš„æ˜¯è¦è®°ä½ <code class="xref c c-type docutils literal notranslate"><span class="pre">pyBytes</span></code> å’Œ Python 3ä¸­çš„ <code class="xref c c-type docutils literal notranslate"><span class="pre">PyUnicode</span></code> ä¸å¯äº’æ¢ï¼Œå¦‚ <code class="xref c c-type docutils literal notranslate"><span class="pre">PyString</span></code> å’Œ <code class="xref c c-type docutils literal notranslate"><span class="pre">PyUnicode</span></code> åœ¨ Python 2 ä»¥ä¸‹ä¸­ç¤ºä¾‹æ˜¾ç¤ºäº†ä»¥ä¸‹æ–¹é¢çš„æœ€ä½³å®è·µ <code class="xref c c-type docutils literal notranslate"><span class="pre">PyUnicode</span></code> ã€ <code class="xref c c-type docutils literal notranslate"><span class="pre">PyString</span></code> å’Œ <code class="xref c c-type docutils literal notranslate"><span class="pre">PyBytes</span></code> ã€‚:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;stdlib.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Python.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;bytesobject.h&quot;</span><span class="cp"></span>

<span class="cm">/* text example */</span>
<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span>
<span class="nf">say_hello</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">self</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTuple</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s">&quot;U:say_hello&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">PyUnicode_FromFormat</span><span class="p">(</span><span class="s">&quot;Hello, %S!&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* just a forward */</span>
<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span> <span class="nf">do_encode</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="p">);</span>

<span class="cm">/* bytes example */</span>
<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span>
<span class="nf">encode_object</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">self</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">encoded</span><span class="p">;</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">result</span><span class="p">,</span> <span class="o">*</span><span class="n">myobj</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTuple</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s">&quot;O:encode_object&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">myobj</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="n">encoded</span> <span class="o">=</span> <span class="n">do_encode</span><span class="p">(</span><span class="n">myobj</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">encoded</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">PyBytes_FromString</span><span class="p">(</span><span class="n">encoded</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">encoded</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="long-int-unification">
<h3>long/int ç»Ÿä¸€<a class="headerlink" href="#long-int-unification" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>Python 3 åªæœ‰ä¸€ä¸ªæ•´æ•°ç±»å‹ï¼Œ <a class="reference internal" href="functions.html#int" tppabs="https://docs.python.org/zh-cn/3/library/functions.html#int" title="int"><code class="xref py py-func docutils literal notranslate"><span class="pre">int()</span></code></a> ã€‚ä½†å®ƒå®é™…ä¸Šå¯¹åº”äºPython 2 <code class="xref py py-func docutils literal notranslate"><span class="pre">long()</span></code>&nbsp;ç±»å‹ â€”â€” åˆ é™¤äº† Python 2 ä¸­ä½¿ç”¨çš„ <a class="reference internal" href="functions.html#int" tppabs="https://docs.python.org/zh-cn/3/library/functions.html#int" title="int"><code class="xref py py-func docutils literal notranslate"><span class="pre">int()</span></code></a> ç±»å‹ã€‚åœ¨ C-API ä¸­ï¼Œ <code class="docutils literal notranslate"><span class="pre">PyInt_*</span></code> å‡½æ•°è¢«å®ƒä»¬ç­‰ä»·çš„ <code class="docutils literal notranslate"><span class="pre">PyLong_*</span></code> æ›¿æ¢ã€‚</p>
</div>
</div>
<div class="section" id="module-initialization-and-state">
<h2>æ¨¡å—åˆå§‹åŒ–å’ŒçŠ¶æ€<a class="headerlink" href="#module-initialization-and-state" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>Python 3 æœ‰ä¸€ä¸ªæ”¹è¿›çš„æ‰©å±•æ¨¡å—åˆå§‹åŒ–ç³»ç»Ÿã€‚ï¼ˆå‚è§ <span class="target" id="index-2"></span><a class="pep reference external" href="javascript:if(confirm('https://www.python.org/dev/peps/pep-3121  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.python.org/dev/peps/pep-3121'" tppabs="https://www.python.org/dev/peps/pep-3121"><strong>PEP 3121</strong></a> ã€‚ï¼‰è€Œä¸æ˜¯å°†æ¨¡å—çŠ¶æ€å­˜å‚¨åœ¨å…¨å±€å˜é‡ä¸­ï¼Œå®ƒä»¬åº”è¯¥å­˜å‚¨åœ¨ç‰¹å®šäºè§£é‡Šå™¨çš„ç»“æ„ä¸­ã€‚åˆ›å»ºåœ¨ Python 2 å’Œ Python 3 ä¸­æ­£ç¡®è¿è¡Œçš„æ¨¡å—éå¸¸æ£˜æ‰‹ã€‚ä»¥ä¸‹ç®€å•ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•æ“ä½œã€‚:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;Python.h&quot;</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">module_state</span> <span class="p">{</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">error</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#if PY_MAJOR_VERSION &gt;= 3</span>
<span class="cp">#define GETSTATE(m) ((struct module_state*)PyModule_GetState(m))</span>
<span class="cp">#else</span>
<span class="cp">#define GETSTATE(m) (&amp;_state)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">module_state</span> <span class="n">_state</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span>
<span class="nf">error_out</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">m</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">module_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">GETSTATE</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
    <span class="n">PyErr_SetString</span><span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">error</span><span class="p">,</span> <span class="s">&quot;something bad happened&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyMethodDef</span> <span class="n">myextension_methods</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span><span class="s">&quot;error_out&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">PyCFunction</span><span class="p">)</span><span class="n">error_out</span><span class="p">,</span> <span class="n">METH_NOARGS</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">},</span>
    <span class="p">{</span><span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">}</span>
<span class="p">};</span>

<span class="cp">#if PY_MAJOR_VERSION &gt;= 3</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">myextension_traverse</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">visitproc</span> <span class="n">visit</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Py_VISIT</span><span class="p">(</span><span class="n">GETSTATE</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">error</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">myextension_clear</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">m</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Py_CLEAR</span><span class="p">(</span><span class="n">GETSTATE</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">error</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="k">struct</span> <span class="n">PyModuleDef</span> <span class="n">moduledef</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">PyModuleDef_HEAD_INIT</span><span class="p">,</span>
        <span class="s">&quot;myextension&quot;</span><span class="p">,</span>
        <span class="nb">NULL</span><span class="p">,</span>
        <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">module_state</span><span class="p">),</span>
        <span class="n">myextension_methods</span><span class="p">,</span>
        <span class="nb">NULL</span><span class="p">,</span>
        <span class="n">myextension_traverse</span><span class="p">,</span>
        <span class="n">myextension_clear</span><span class="p">,</span>
        <span class="nb">NULL</span>
<span class="p">};</span>

<span class="cp">#define INITERROR return NULL</span>

<span class="n">PyMODINIT_FUNC</span>
<span class="nf">PyInit_myextension</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="cp">#else</span>
<span class="cp">#define INITERROR return</span>

<span class="kt">void</span>
<span class="n">initmyextension</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="cp">#endif</span>
<span class="p">{</span>
<span class="cp">#if PY_MAJOR_VERSION &gt;= 3</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">module</span> <span class="o">=</span> <span class="n">PyModule_Create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">moduledef</span><span class="p">);</span>
<span class="cp">#else</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">module</span> <span class="o">=</span> <span class="n">Py_InitModule</span><span class="p">(</span><span class="s">&quot;myextension&quot;</span><span class="p">,</span> <span class="n">myextension_methods</span><span class="p">);</span>
<span class="cp">#endif</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">module</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="n">INITERROR</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">module_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">GETSTATE</span><span class="p">(</span><span class="n">module</span><span class="p">);</span>

    <span class="n">st</span><span class="o">-&gt;</span><span class="n">error</span> <span class="o">=</span> <span class="n">PyErr_NewException</span><span class="p">(</span><span class="s">&quot;myextension.Error&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">error</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">module</span><span class="p">);</span>
        <span class="n">INITERROR</span><span class="p">;</span>
    <span class="p">}</span>

<span class="cp">#if PY_MAJOR_VERSION &gt;= 3</span>
    <span class="k">return</span> <span class="n">module</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="cobject-replaced-with-capsule">
<h2>CObject æ›¿æ¢ä¸º Capsule<a class="headerlink" href="#cobject-replaced-with-capsule" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p><code class="xref c c-type docutils literal notranslate"><span class="pre">Capsule</span></code> å¯¹è±¡æ˜¯åœ¨ Python 3.1 å’Œ 2.7 ä¸­å¼•å…¥çš„ï¼Œç”¨äºæ›¿æ¢ <code class="xref c c-type docutils literal notranslate"><span class="pre">CObject</span></code> ã€‚ CObject æ˜¯æœ‰ç”¨çš„ï¼Œä½†æ˜¯ <code class="xref c c-type docutils literal notranslate"><span class="pre">CObject</span></code> API æ˜¯æœ‰é—®é¢˜çš„ï¼šå®ƒä¸å…è®¸åŒºåˆ†æœ‰æ•ˆçš„ CObject ï¼Œè¿™å¯¼è‡´ä¸åŒ¹é…çš„ CObject ä½¿è§£é‡Šå™¨å´©æºƒï¼Œå¹¶ä¸”å®ƒçš„ä¸€äº› API ä¾èµ–äº C ä¸­çš„æœªå®šä¹‰è¡Œä¸ºã€‚æœ‰å…³ Capsule èƒŒåçš„åŸºæœ¬åŸç†çš„è¿›ä¸€æ­¥é˜…è¯»ï¼Œè¯·å‚é˜… <a class="reference external" href="javascript:if(confirm('https://bugs.python.org/issue5630  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://bugs.python.org/issue5630'" tppabs="https://bugs.python.org/issue5630">bpo-5630</a> ã€‚ï¼‰</p>
<p>å¦‚æœä½ å½“å‰æ­£åœ¨ä½¿ç”¨ CObject ï¼Œå¹¶ä¸”æƒ³è¦è¿ç§»åˆ° 3.1 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œåˆ™éœ€è¦åˆ‡æ¢åˆ° Capsules ã€‚ <code class="xref c c-type docutils literal notranslate"><span class="pre">CObject</span></code> åœ¨ 3.1 å’Œ 2.7 ä¸­å·²å¼ƒç”¨ï¼Œåœ¨ Python 3.2 ä¸­å·²å®Œå…¨åˆ é™¤ã€‚å¦‚æœä½ åªæ”¯æŒ 2.7 æˆ– 3.1 åŠä»¥ä¸Šï¼Œä½ å¯ä»¥ç®€å•åœ°åˆ‡æ¢åˆ° <code class="xref c c-type docutils literal notranslate"><span class="pre">Capsule</span></code> ã€‚å¦‚æœä½ éœ€è¦æ”¯æŒ Python 3.0 æˆ–æ—©äº 2.7 çš„ Python ç‰ˆæœ¬ï¼Œåˆ™å¿…é¡»åŒæ—¶æ”¯æŒ CObject å’Œ Capsule ã€‚ï¼ˆè¯·æ³¨æ„ï¼Œä¸å†æ”¯æŒ Python 3.0 ï¼Œä¸å»ºè®®å°†å…¶ç”¨äºç”Ÿäº§ç”¨é€”ã€‚ï¼‰</p>
<p>ä»¥ä¸‹ç¤ºä¾‹å¤´æ–‡ä»¶ <code class="file docutils literal notranslate"><span class="pre">capsulethunk.h</span></code> å¯ä»¥ä¸ºä½ è§£å†³é—®é¢˜ã€‚åªéœ€é’ˆå¯¹ <code class="xref c c-type docutils literal notranslate"><span class="pre">Capsule</span></code> API ç¼–å†™ä»£ç ï¼Œå¹¶åœ¨ä»¥ä¸‹æ–‡ä»¶ååŒ…å«æ­¤å¤´æ–‡ä»¶ <code class="file docutils literal notranslate"><span class="pre">Python.h</span></code> ã€‚ä½ çš„ä»£ç å°†è‡ªåŠ¨åœ¨å¸¦æœ‰ Capsule çš„ Python ç‰ˆæœ¬ä¸­ä½¿ç”¨ Capsules ï¼Œå¹¶åœ¨ Capsule ä¸å¯ç”¨æ—¶åˆ‡æ¢åˆ° CObjects ã€‚</p>
<p><code class="file docutils literal notranslate"><span class="pre">capsulethunk.h</span></code> ä½¿ç”¨ CObject æ¨¡æ‹Ÿ Capsules ã€‚ ä½†æ˜¯ï¼Œ <code class="xref c c-type docutils literal notranslate"><span class="pre">CObject</span></code> æ²¡æœ‰æä¾›å­˜å‚¨èƒ¶å›Šçš„â€œåç§°â€çš„åœ°æ–¹ã€‚å› æ­¤ï¼Œæ¨¡æ‹Ÿ <code class="xref c c-type docutils literal notranslate"><span class="pre">Capsule</span></code> å¯¹è±¡ç”± <code class="file docutils literal notranslate"><span class="pre">capsulethunk.h</span></code> åˆ›å»ºï¼Œå…¶è¡Œä¸ºä¸çœŸå® Capsule ç•¥æœ‰ä¸åŒã€‚ç‰¹åˆ«åœ°ï¼š</p>
<blockquote>
<div><ul class="simple">
<li>ä¼ é€’ç»™ <a class="reference internal" href="capsule.html#c.PyCapsule_New" tppabs="https://docs.python.org/zh-cn/3/c-api/capsule.html#c.PyCapsule_New" title="PyCapsule_New"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCapsule_New()</span></code></a> çš„ name å‚æ•°è¢«å¿½ç•¥ã€‚</li>
<li>ä¼ å…¥ä»¥ä¸‹å‘½ä»¤çš„ name å‚æ•° <a class="reference internal" href="capsule.html#c.PyCapsule_IsValid" tppabs="https://docs.python.org/zh-cn/3/c-api/capsule.html#c.PyCapsule_IsValid" title="PyCapsule_IsValid"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCapsule_IsValid()</span></code></a> å’Œ <a class="reference internal" href="capsule.html#c.PyCapsule_GetPointer" tppabs="https://docs.python.org/zh-cn/3/c-api/capsule.html#c.PyCapsule_GetPointer" title="PyCapsule_GetPointer"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCapsule_GetPointer()</span></code></a> è¢«å¿½ç•¥ï¼Œå¹¶ä¸”ä¸æ‰§è¡Œé”™è¯¯æ£€æŸ¥ã€‚</li>
<li><a class="reference internal" href="capsule.html#c.PyCapsule_GetName" tppabs="https://docs.python.org/zh-cn/3/c-api/capsule.html#c.PyCapsule_GetName" title="PyCapsule_GetName"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCapsule_GetName()</span></code></a> æ€»æ˜¯è¿”å› NULL ã€‚</li>
<li><a class="reference internal" href="capsule.html#c.PyCapsule_SetName" tppabs="https://docs.python.org/zh-cn/3/c-api/capsule.html#c.PyCapsule_SetName" title="PyCapsule_SetName"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCapsule_SetName()</span></code></a> æ€»æ˜¯å¼•å‘å¼‚å¸¸å¹¶è¿”å›å¤±è´¥ã€‚ï¼ˆç”±äºæ— æ³•åœ¨ CObject ä¸­å­˜å‚¨åç§°ï¼Œå› æ­¤ <a class="reference internal" href="capsule.html#c.PyCapsule_SetName" tppabs="https://docs.python.org/zh-cn/3/c-api/capsule.html#c.PyCapsule_SetName" title="PyCapsule_SetName"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCapsule_SetName()</span></code></a> çš„æ˜æ˜¾å¤±è´¥è¢«è®¤ä¸ºä¼˜äºé™é»˜å¤±è´¥ã€‚å¦‚æœè¿™æ ·ä¸æ–¹ä¾¿ï¼Œè¯·éšæ„æ ¹æ®éœ€è¦ä¿®æ”¹æœ¬åœ°å‰¯æœ¬ã€‚ï¼‰</li>
</ul>
</div></blockquote>
<p>ä½ å¯ä»¥åœ¨ Python æºä»£ç åˆ†å‘ä¸­çš„ <a class="reference external" href="javascript:if(confirm('https://github.com/python/cpython/tree/3.7/Doc/includes/issue25928  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://github.com/python/cpython/tree/3.7/Doc/includes/issue25928'" tppabs="https://github.com/python/cpython/tree/3.7/Doc/includes/capsulethunk.h">Doc/includes/capsulethunk.h</a> æ‰¾åˆ° <code class="file docutils literal notranslate"><span class="pre">capsulethunk.h</span></code> ã€‚ä¸ºæ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬è¿˜å°†å…¶åŒ…å«åœ¨æ­¤å¤„ï¼š</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef __CAPSULETHUNK_H</span>
<span class="cp">#define __CAPSULETHUNK_H</span>

<span class="cp">#if (    (PY_VERSION_HEX &lt;  0x02070000) \</span>
<span class="cp">     || ((PY_VERSION_HEX &gt;= 0x03000000) \</span>
<span class="cp">      &amp;&amp; (PY_VERSION_HEX &lt;  0x03010000)) )</span>

<span class="cp">#define __PyCapsule_GetField(capsule, field, default_value) \</span>
<span class="cp">    ( PyCapsule_CheckExact(capsule) \</span>
<span class="cp">        ? (((PyCObject *)capsule)-&gt;field) \</span>
<span class="cp">        : (default_value) \</span>
<span class="cp">    ) \</span>

<span class="cp">#define __PyCapsule_SetField(capsule, field, value) \</span>
<span class="cp">    ( PyCapsule_CheckExact(capsule) \</span>
<span class="cp">        ? (((PyCObject *)capsule)-&gt;field = value), 1 \</span>
<span class="cp">        : 0 \</span>
<span class="cp">    ) \</span>


<span class="cp">#define PyCapsule_Type PyCObject_Type</span>

<span class="cp">#define PyCapsule_CheckExact(capsule) (PyCObject_Check(capsule))</span>
<span class="cp">#define PyCapsule_IsValid(capsule, name) (PyCObject_Check(capsule))</span>


<span class="cp">#define PyCapsule_New(pointer, name, destructor) \</span>
<span class="cp">    (PyCObject_FromVoidPtr(pointer, destructor))</span>


<span class="cp">#define PyCapsule_GetPointer(capsule, name) \</span>
<span class="cp">    (PyCObject_AsVoidPtr(capsule))</span>

<span class="cm">/* Don&#39;t call PyCObject_SetPointer here, it fails if there&#39;s a destructor */</span>
<span class="cp">#define PyCapsule_SetPointer(capsule, pointer) \</span>
<span class="cp">    __PyCapsule_SetField(capsule, cobject, pointer)</span>


<span class="cp">#define PyCapsule_GetDestructor(capsule) \</span>
<span class="cp">    __PyCapsule_GetField(capsule, destructor)</span>

<span class="cp">#define PyCapsule_SetDestructor(capsule, dtor) \</span>
<span class="cp">    __PyCapsule_SetField(capsule, destructor, dtor)</span>


<span class="cm">/*</span>
<span class="cm"> * Sorry, there&#39;s simply no place</span>
<span class="cm"> * to store a Capsule &quot;name&quot; in a CObject.</span>
<span class="cm"> */</span>
<span class="cp">#define PyCapsule_GetName(capsule) NULL</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">PyCapsule_SetName</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">capsule</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">unused</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">unused</span> <span class="o">=</span> <span class="n">unused</span><span class="p">;</span>
    <span class="n">PyErr_SetString</span><span class="p">(</span><span class="n">PyExc_NotImplementedError</span><span class="p">,</span>
        <span class="s">&quot;can&#39;t use PyCapsule_SetName with CObjects&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>



<span class="cp">#define PyCapsule_GetContext(capsule) \</span>
<span class="cp">    __PyCapsule_GetField(capsule, descr)</span>

<span class="cp">#define PyCapsule_SetContext(capsule, context) \</span>
<span class="cp">    __PyCapsule_SetField(capsule, descr, context)</span>


<span class="k">static</span> <span class="kt">void</span> <span class="o">*</span>
<span class="nf">PyCapsule_Import</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">no_block</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">object</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">return_value</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">trace</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">name_length</span> <span class="o">=</span> <span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">);</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">name_dup</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">PyMem_MALLOC</span><span class="p">(</span><span class="n">name_length</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">name_dup</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">memcpy</span><span class="p">(</span><span class="n">name_dup</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">name_length</span><span class="p">);</span>

    <span class="n">trace</span> <span class="o">=</span> <span class="n">name_dup</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="o">*</span><span class="n">dot</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="sc">&#39;.&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dot</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">*</span><span class="n">dot</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">object</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">no_block</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">object</span> <span class="o">=</span> <span class="n">PyImport_ImportModuleNoBlock</span><span class="p">(</span><span class="n">trace</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">object</span> <span class="o">=</span> <span class="n">PyImport_ImportModule</span><span class="p">(</span><span class="n">trace</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">object</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">PyErr_Format</span><span class="p">(</span><span class="n">PyExc_ImportError</span><span class="p">,</span>
                        <span class="s">&quot;PyCapsule_Import could not &quot;</span>
                        <span class="s">&quot;import module </span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">trace</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">PyObject</span> <span class="o">*</span><span class="n">object2</span> <span class="o">=</span> <span class="n">PyObject_GetAttrString</span><span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="n">trace</span><span class="p">);</span>
            <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">object</span><span class="p">);</span>
            <span class="n">object</span> <span class="o">=</span> <span class="n">object2</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">object</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">goto</span> <span class="n">EXIT</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="n">dot</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">PyCObject_Check</span><span class="p">(</span><span class="n">object</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">PyCObject</span> <span class="o">*</span><span class="n">cobject</span> <span class="o">=</span> <span class="p">(</span><span class="n">PyCObject</span> <span class="o">*</span><span class="p">)</span><span class="n">object</span><span class="p">;</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="n">cobject</span><span class="o">-&gt;</span><span class="n">cobject</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">PyErr_Format</span><span class="p">(</span><span class="n">PyExc_AttributeError</span><span class="p">,</span>
            <span class="s">&quot;PyCapsule_Import </span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s"> is not valid&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="p">);</span>
    <span class="p">}</span>

<span class="nl">EXIT</span><span class="p">:</span>
    <span class="n">Py_XDECREF</span><span class="p">(</span><span class="n">object</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name_dup</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">PyMem_FREE</span><span class="p">(</span><span class="n">name_dup</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">return_value</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* #if PY_VERSION_HEX &lt; 0x02070000 */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __CAPSULETHUNK_H */</span><span class="cp"></span>
</pre></div>
</div>
</div>
<div class="section" id="other-options">
<h2>å…¶ä»–é€‰é¡¹<a class="headerlink" href="#other-options" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>å¦‚æœä½ æ­£åœ¨ç¼–å†™æ–°çš„æ‰©å±•æ¨¡å—ï¼Œä½ å¯èƒ½ä¼šè€ƒè™‘ <a class="reference external" href="javascript:if(confirm('http://cython.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://cython.org/'" tppabs="http://cython.org/">Cython</a> ã€‚ å®ƒå°†ç±»ä¼¼ Python çš„è¯­è¨€è½¬æ¢ä¸º C ã€‚å®ƒåˆ›å»ºçš„æ‰©å±•æ¨¡å—ä¸ Python 3 å’Œ Python 2 å…¼å®¹ã€‚</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="contents.html" tppabs="https://docs.python.org/zh-cn/3/contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">å°†æ‰©å±•æ¨¡å—ç§»æ¤åˆ° Python 3</a><ul>
<li><a class="reference internal" href="#conditional-compilation">æ¡ä»¶ç¼–è¯‘</a></li>
<li><a class="reference internal" href="#changes-to-object-apis">å¯¹è±¡APIçš„æ›´æ”¹</a><ul>
<li><a class="reference internal" href="#str-unicode-unification">str/unicode ç»Ÿä¸€</a></li>
<li><a class="reference internal" href="#long-int-unification">long/int ç»Ÿä¸€</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-initialization-and-state">æ¨¡å—åˆå§‹åŒ–å’ŒçŠ¶æ€</a></li>
<li><a class="reference internal" href="#cobject-replaced-with-capsule">CObject æ›¿æ¢ä¸º Capsule</a></li>
<li><a class="reference internal" href="#other-options">å…¶ä»–é€‰é¡¹</a></li>
</ul>
</li>
</ul>

  <h4>ä¸Šä¸€ä¸ªä¸»é¢˜</h4>
  <p class="topless"><a href="pyporting.html" tppabs="https://docs.python.org/zh-cn/3/howto/pyporting.html"
                        title="ä¸Šä¸€ç« ">å°† Python 2 ä»£ç è¿ç§»åˆ° Python 3</a></p>
  <h4>ä¸‹ä¸€ä¸ªä¸»é¢˜</h4>
  <p class="topless"><a href="curses-1.html" tppabs="https://docs.python.org/zh-cn/3/howto/curses.html"
                        title="ä¸‹ä¸€ç« ">Curses Programming with Python</a></p>
  <div role="note" aria-label="source link">
    <h3>æœ¬é¡µ</h3>
    <ul class="this-page-menu">
      <li><a href="bugs.html" tppabs="https://docs.python.org/zh-cn/3/bugs.html">æäº¤ Bug</a></li>
      <li>
        <a href="javascript:if(confirm('https://github.com/python/cpython/blob/3.7/Doc/howto/cporting.rst  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://github.com/python/cpython/blob/3.7/Doc/howto/cporting.rst'" tppabs="https://github.com/python/cpython/blob/3.7/Doc/howto/cporting.rst"
            rel="nofollow">æ˜¾ç¤ºæºä»£ç 
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>å¯¼èˆª</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" tppabs="https://docs.python.org/zh-cn/3/genindex.html" title="æ€»ç›®å½•"
             >ç´¢å¼•</a></li>
        <li class="right" >
          <a href="py-modindex.html" tppabs="https://docs.python.org/zh-cn/3/py-modindex.html" title="Python æ¨¡å—ç´¢å¼•"
             >æ¨¡å—</a> |</li>
        <li class="right" >
          <a href="curses-1.html" tppabs="https://docs.python.org/zh-cn/3/howto/curses.html" title="Curses Programming with Python"
             >ä¸‹ä¸€é¡µ</a> |</li>
        <li class="right" >
          <a href="pyporting.html" tppabs="https://docs.python.org/zh-cn/3/howto/pyporting.html" title="å°† Python 2 ä»£ç è¿ç§»åˆ° Python 3"
             >ä¸Šä¸€é¡µ</a> |</li>
        <li><img src="py.png" tppabs="https://docs.python.org/zh-cn/3/_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="javascript:if(confirm('https://www.python.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.python.org/'" tppabs="https://www.python.org/">Python</a> &#187;</li>
        <li>
          <span class="language_switcher_placeholder">zh_CN</span>
          <span class="version_switcher_placeholder">3.7.3</span>
          <a href="index-11.html" tppabs="https://docs.python.org/zh-cn/3/index.html">æ–‡æ¡£</a> &#187;
        </li>

          <li class="nav-item nav-item-1"><a href="index-5.html" tppabs="https://docs.python.org/zh-cn/3/howto/index.html" >Python å¸¸ç”¨æŒ‡å¼•</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="https://docs.python.org/zh-cn/3/search.html" method="get">
          <input placeholder="å¿«é€Ÿæœç´¢" type="text" name="q" />
          <input type="submit" value="è½¬å‘" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="copyright.html" tppabs="https://docs.python.org/zh-cn/3/copyright.html">ç‰ˆæƒæ‰€æœ‰</a> 2001-2019, Python Software Foundation.
    <br />
    Python è½¯ä»¶åŸºé‡‘ä¼šæ˜¯ä¸€ä¸ªéç›ˆåˆ©ç»„ç»‡ã€‚
    <a href="javascript:if(confirm('https://www.python.org/psf/donations/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.python.org/psf/donations/'" tppabs="https://www.python.org/psf/donations/">è¯·æåŠ©ã€‚</a>
    <br />
    æœ€åæ›´æ–°äº 4æœˆ 22, 2019.
    <a href="bugs.html" tppabs="https://docs.python.org/zh-cn/3/bugs.html">å‘ç°äº†é—®é¢˜</a>ï¼Ÿ
    <br />
    ä½¿ç”¨<a href="javascript:if(confirm('http://sphinx.pocoo.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://sphinx.pocoo.org/'" tppabs="http://sphinx.pocoo.org/">Sphinx</a>1.8.4 åˆ›å»ºã€‚
    </div>

  </body>
</html>