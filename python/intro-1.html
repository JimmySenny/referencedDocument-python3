
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>æ¦‚è¿° &#8212; Python 3.7.3 æ–‡æ¡£</title>
    <link rel="stylesheet" href="pydoctheme.css" tppabs="https://docs.python.org/zh-cn/3/_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="pygments.css" tppabs="https://docs.python.org/zh-cn/3/_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="documentation_options.js" tppabs="https://docs.python.org/zh-cn/3/_static/documentation_options.js"></script>
    <script type="text/javascript" src="jquery.js" tppabs="https://docs.python.org/zh-cn/3/_static/jquery.js"></script>
    <script type="text/javascript" src="underscore.js" tppabs="https://docs.python.org/zh-cn/3/_static/underscore.js"></script>
    <script type="text/javascript" src="doctools.js" tppabs="https://docs.python.org/zh-cn/3/_static/doctools.js"></script>
    <script type="text/javascript" src="language_data.js" tppabs="https://docs.python.org/zh-cn/3/_static/language_data.js"></script>
    <script type="text/javascript" src="translations.js" tppabs="https://docs.python.org/zh-cn/3/_static/translations.js"></script>
    
    <script type="text/javascript" src="sidebar.js" tppabs="https://docs.python.org/zh-cn/3/_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="åœ¨ Python 3.7.3 æ–‡æ¡£ ä¸­æœç´¢"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="å…³äºè¿™äº›æ–‡æ¡£" href="../about.html" />
    <link rel="index" title="ç´¢å¼•" href="../genindex.html" />
    <link rel="search" title="æœç´¢" href="../search.html" />
    <link rel="copyright" title="ç‰ˆæƒæ‰€æœ‰" href="../copyright.html" />
    <link rel="next" title="ç¨³å®šçš„åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£" href="stable.html" />
    <link rel="prev" title="Python/C API å‚è€ƒæ‰‹å†Œ" href="index.html" />
    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    <link rel="canonical" href="https://docs.python.org/3/c-api/intro.html" />
    
    <script type="text/javascript" src="copybutton.js" tppabs="https://docs.python.org/zh-cn/3/_static/copybutton.js"></script>
    <script type="text/javascript" src="switchers.js" tppabs="https://docs.python.org/zh-cn/3/_static/switchers.js"></script>
    
    
    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
 

  </head><body>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>å¯¼èˆª</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" tppabs="https://docs.python.org/zh-cn/3/genindex.html" title="æ€»ç›®å½•"
             accesskey="I">ç´¢å¼•</a></li>
        <li class="right" >
          <a href="py-modindex.html" tppabs="https://docs.python.org/zh-cn/3/py-modindex.html" title="Python æ¨¡å—ç´¢å¼•"
             >æ¨¡å—</a> |</li>
        <li class="right" >
          <a href="stable.html" tppabs="https://docs.python.org/zh-cn/3/c-api/stable.html" title="ç¨³å®šçš„åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£"
             accesskey="N">ä¸‹ä¸€é¡µ</a> |</li>
        <li class="right" >
          <a href="index-9.html" tppabs="https://docs.python.org/zh-cn/3/c-api/index.html" title="Python/C API å‚è€ƒæ‰‹å†Œ"
             accesskey="P">ä¸Šä¸€é¡µ</a> |</li>
        <li><img src="py.png" tppabs="https://docs.python.org/zh-cn/3/_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="javascript:if(confirm('https://www.python.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.python.org/'" tppabs="https://www.python.org/">Python</a> &#187;</li>
        <li>
          <span class="language_switcher_placeholder">zh_CN</span>
          <span class="version_switcher_placeholder">3.7.3</span>
          <a href="index-11.html" tppabs="https://docs.python.org/zh-cn/3/index.html">æ–‡æ¡£</a> &#187;
        </li>

          <li class="nav-item nav-item-1"><a href="index-9.html" tppabs="https://docs.python.org/zh-cn/3/c-api/index.html" accesskey="U">Python/C API å‚è€ƒæ‰‹å†Œ</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="https://docs.python.org/zh-cn/3/search.html" method="get">
          <input placeholder="å¿«é€Ÿæœç´¢" type="text" name="q" />
          <input type="submit" value="è½¬å‘" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="introduction">
<span id="api-intro"></span><h1>æ¦‚è¿°<a class="headerlink" href="#introduction" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h1>
<p>Python çš„åº”ç”¨ç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰ä½¿å¾— C å’Œ C++ ç¨‹åºå‘˜å¯ä»¥åœ¨å¤šä¸ªå±‚çº§ä¸Šè®¿é—® Python è§£é‡Šå™¨ã€‚è¯¥ API åœ¨ C++ ä¸­åŒæ ·å¯ç”¨ï¼Œä½†ä¸ºç®€åŒ–æè¿°ï¼Œé€šå¸¸å°†å…¶ç§°ä¸º Python/C APIã€‚ä½¿ç”¨ Python/C API æœ‰ä¸¤ä¸ªåŸºæœ¬çš„ç†ç”±ã€‚ç¬¬ä¸€ä¸ªç†ç”±æ˜¯ä¸ºäº†ç‰¹å®šç›®çš„è€Œç¼–å†™ <em>æ‰©å±•æ¨¡å—</em>ï¼›å®ƒä»¬æ˜¯æ‰©å±• Python è§£é‡Šå™¨åŠŸèƒ½çš„ C æ¨¡å—ã€‚è¿™å¯èƒ½æ˜¯æœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯ã€‚ç¬¬äºŒä¸ªç†ç”±æ˜¯å°† Python ç”¨ä½œæ›´å¤§è§„æ¨¡åº”ç”¨çš„ç»„ä»¶ï¼›è¿™ç§æŠ€å·§é€šå¸¸è¢«ç§°ä¸ºåœ¨ä¸€ä¸ªåº”ç”¨ä¸­ <em class="dfn">embedding</em> Pythonã€‚</p>
<p>ç¼–å†™æ‰©å±•æ¨¡å—çš„è¿‡ç¨‹ç›¸å¯¹æ¥è¯´æ›´æ˜“äºç†è§£ï¼Œå¯ä»¥é€šè¿‡â€œèœè°±â€çš„å½¢å¼åˆ†æ­¥éª¤ä»‹ç»ã€‚ä½¿ç”¨æŸäº›å·¥å…·å¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šè‡ªåŠ¨åŒ–è¿™ä¸€è¿‡ç¨‹ã€‚è™½ç„¶äººä»¬åœ¨å…¶ä»–åº”ç”¨ä¸­åµŒå…¥ Python çš„åšæ³•æ—©å·²æœ‰ä¹‹ï¼Œä½†åµŒå…¥ Python çš„è¿‡ç¨‹æ²¡æœ‰ç¼–å†™æ‰©å±•æ¨¡å—é‚£æ ·æ–¹ä¾¿ç›´è§‚ã€‚</p>
<p>è®¸å¤š API å‡½æ•°åœ¨ä½ åµŒå…¥æˆ–æ˜¯æ‰©å±• Python è¿™ä¸¤ç§åœºæ™¯ä¸‹éƒ½èƒ½å‘æŒ¥ä½œç”¨ï¼›æ­¤å¤–ï¼Œå¤§å¤šæ•°åµŒå…¥ Python çš„åº”ç”¨ç¨‹åºä¹Ÿéœ€è¦æä¾›è‡ªå®šä¹‰æ‰©å±•ï¼Œå› æ­¤åœ¨å°è¯•åœ¨å®é™…åº”ç”¨ä¸­åµŒå…¥ Python ä¹‹å‰å…ˆç†Ÿæ‚‰ç¼–å†™æ‰©å±•åº”è¯¥ä¼šæ˜¯ä¸ªå¥½ä¸»æ„ã€‚</p>
<div class="section" id="coding-standards">
<h2>ä»£ç æ ‡å‡†<a class="headerlink" href="#coding-standards" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>å¦‚æœä½ æƒ³è¦ç¼–å†™å¯åŒ…å«äº CPython çš„ C ä»£ç ï¼Œä½  <strong>å¿…é¡»</strong> éµå¾ªåœ¨ <span class="target" id="index-36"></span><a class="pep reference external" href="javascript:if(confirm('https://www.python.org/dev/peps/pep-0007  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.python.org/dev/peps/pep-0007'" tppabs="https://www.python.org/dev/peps/pep-0007"><strong>PEP 7</strong></a> ä¸­å®šä¹‰çš„æŒ‡å¯¼åŸåˆ™å’Œæ ‡å‡†ã€‚è¿™äº›æŒ‡å¯¼åŸåˆ™é€‚ç”¨äºä»»ä½•ä½ æ‰€è¦æ‰©å±•çš„ Python ç‰ˆæœ¬ã€‚åœ¨ç¼–å†™ä½ è‡ªå·±çš„ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—æ—¶å¯ä»¥ä¸å¿…éµå¾ªè¿™äº›è§„èŒƒï¼Œé™¤éä½ å‡†å¤‡åœ¨æ—¥åå‘ Python è´¡çŒ®è¿™äº›æ¨¡å—ã€‚</p>
</div>
<div class="section" id="include-files">
<span id="api-includes"></span><h2>åŒ…å«æ–‡ä»¶<a class="headerlink" href="#include-files" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>ä½¿ç”¨ Python/C API æ‰€éœ€è¦çš„å…¨éƒ¨å‡½æ•°ã€ç±»å‹å’Œå®å®šä¹‰å¯é€šè¿‡ä¸‹é¢è¿™è¡Œè¯­å¥åŒ…å«åˆ°ä½ çš„ä»£ç ä¹‹ä¸­ï¼š</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define PY_SSIZE_T_CLEAN</span>
<span class="cp">#include</span> <span class="cpf">&lt;Python.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>è¿™æ„å‘³ç€åŒ…å«ä»¥ä¸‹æ ‡å‡†å¤´æ–‡ä»¶ï¼š<code class="docutils literal notranslate"><span class="pre">&lt;stdio.h&gt;</span></code>ï¼Œ<code class="docutils literal notranslate"><span class="pre">&lt;string.h&gt;</span></code>ï¼Œ<code class="docutils literal notranslate"><span class="pre">&lt;errno.h&gt;</span></code>ï¼Œ<code class="docutils literal notranslate"><span class="pre">&lt;limits.h&gt;</span></code>ï¼Œ<code class="docutils literal notranslate"><span class="pre">&lt;assert.h&gt;</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">&lt;stdlib.h&gt;</span></code>ï¼ˆå¦‚æœå¯ç”¨ï¼‰ã€‚</p>
<div class="admonition note">
<p class="first admonition-title">æ³¨è§£</p>
<p>ç”±äº Python å¯èƒ½ä¼šå®šä¹‰ä¸€äº›èƒ½åœ¨æŸäº›ç³»ç»Ÿä¸Šå½±å“æ ‡å‡†å¤´æ–‡ä»¶çš„é¢„å¤„ç†å™¨å®šä¹‰ï¼Œå› æ­¤åœ¨åŒ…å«ä»»ä½•æ ‡å‡†å¤´æ–‡ä»¶ä¹‹å‰ï¼Œä½  <em>å¿…é¡»</em> å…ˆåŒ…å« <code class="file docutils literal notranslate"><span class="pre">Python.h</span></code>ã€‚</p>
<p class="last">It is recommended to always define <code class="docutils literal notranslate"><span class="pre">PY_SSIZE_T_CLEAN</span></code> before including
<code class="docutils literal notranslate"><span class="pre">Python.h</span></code>.  See <a class="reference internal" href="arg.html#arg-parsing" tppabs="https://docs.python.org/zh-cn/3/c-api/arg.html#arg-parsing"><span class="std std-ref">è¯­å¥è§£é‡ŠåŠå˜é‡ç¼–è¯‘</span></a> for a description of this macro.</p>
</div>
<p>Python.h æ‰€å®šä¹‰çš„å…¨éƒ¨ç”¨æˆ·å¯è§åç§°ï¼ˆç”±åŒ…å«çš„æ ‡å‡†å¤´æ–‡ä»¶æ‰€å®šä¹‰çš„é™¤å¤–ï¼‰éƒ½å¸¦æœ‰å‰ç¼€ <code class="docutils literal notranslate"><span class="pre">Py</span></code> æˆ–è€… <code class="docutils literal notranslate"><span class="pre">_Py</span></code>ã€‚ä»¥ <code class="docutils literal notranslate"><span class="pre">_Py</span></code> æ‰“å¤´çš„åç§°æ˜¯ä¾› Python å®ç°å†…éƒ¨ä½¿ç”¨çš„ï¼Œä¸åº”è¢«æ‰©å±•ç¼–å†™è€…ä½¿ç”¨ã€‚ç»“æ„æˆå‘˜åç§°æ²¡æœ‰ä¿ç•™å‰ç¼€ã€‚</p>
<p><strong>é‡è¦ï¼š</strong>  ç”¨æˆ·ä»£ç æ°¸è¿œä¸åº”è¯¥å®šä¹‰ä»¥ <code class="docutils literal notranslate"><span class="pre">Py`</span> <span class="pre">`æˆ–</span> <span class="pre">``_Py</span></code> å¼€å¤´çš„åç§°ã€‚è¿™ä¼šä½¿è¯»è€…æ„Ÿåˆ°å›°æƒ‘ï¼Œå¹¶å±åŠç”¨æˆ·ä»£ç å¯¹æœªæ¥ Python ç‰ˆæœ¬çš„å¯ç§»æ¤æ€§ï¼Œå› ä¸ºæœªæ¥ç‰ˆæœ¬å¯èƒ½ä¼šé¢å¤–å®šä¹‰ä»¥è¿™äº›å‰ç¼€ä¹‹ä¸€å¼€å¤´çš„åç§°ã€‚</p>
<p>å¤´æ–‡ä»¶é€šå¸¸ä¼šä¸ Python ä¸€èµ·å®‰è£…ã€‚åœ¨ Unix ä¸Šï¼Œå®ƒä»¬ä½äºä»¥ä¸‹ç›®å½•ï¼š<code class="file docutils literal notranslate"><em><span class="pre">prefix</span></em><span class="pre">/include/pythonversion/</span></code> å’Œ <code class="file docutils literal notranslate"><em><span class="pre">exec_prefix</span></em><span class="pre">/include/pythonversion/</span></code>ï¼Œå…¶ä¸­ <span class="target" id="index-37"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">prefix</span></code> å’Œ <span class="target" id="index-38"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">exec_prefix</span></code> æ˜¯ç”±å‘ Python çš„ <strong class="program">configure</strong> è„šæœ¬ä¼ å…¥çš„å¯¹åº”å½¢å‚æ‰€å®šä¹‰ï¼Œè€Œ <em>version</em> åˆ™ä¸º <code class="docutils literal notranslate"><span class="pre">'%d.%d'</span> <span class="pre">%</span> <span class="pre">sys.version_info[:2]</span></code>ã€‚åœ¨ Windows ä¸Šï¼Œå¤´æ–‡ä»¶å®‰è£…äº <code class="file docutils literal notranslate"><em><span class="pre">prefix</span></em><span class="pre">/include</span></code>ï¼Œå…¶ä¸­ <span class="target" id="index-39"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">prefix</span></code> æ˜¯å‘å®‰è£…ç¨‹åºæŒ‡å®šçš„å®‰è£…ç›®å½•ã€‚</p>
<p>è¦åŒ…å«å¤´æ–‡ä»¶ï¼Œè¯·å°†ä¸¤ä¸ªç›®å½•ï¼ˆå¦‚æœä¸åŒï¼‰éƒ½æ”¾åˆ°ä½ æ‰€ç”¨ç¼–è¯‘å™¨çš„åŒ…å«æœç´¢è·¯å¾„ä¸­ã€‚è¯· <em>ä¸è¦</em> å°†çˆ¶ç›®å½•æ”¾å…¥æœç´¢è·¯å¾„ç„¶åä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&lt;pythonX.Y/Python.h&gt;</span></code>ï¼›è¿™å°†ä½¿å¾—å¤šå¹³å°ç¼–è¯‘ä¸å¯ç”¨ï¼Œå› ä¸º <span class="target" id="index-40"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">prefix</span></code> ä¸‹å¹³å°æ— å…³çš„å¤´æ–‡ä»¶éœ€è¦åŒ…å«æ¥è‡ª <span class="target" id="index-41"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">exec_prefix</span></code> ä¸‹ç‰¹å®šå¹³å°çš„å¤´æ–‡ä»¶ã€‚</p>
<p>C++ ç”¨æˆ·åº”è¯¥æ³¨æ„ï¼Œå°½ç®¡ API æ˜¯å®Œå…¨ä½¿ç”¨ C æ¥å®šä¹‰çš„ï¼Œä½†å¤´æ–‡ä»¶æ­£ç¡®åœ°å°†å…¥å£ç‚¹å£°æ˜ä¸º <code class="docutils literal notranslate"><span class="pre">extern</span> <span class="pre">&quot;C&quot;</span></code>ï¼Œå› æ­¤ API åœ¨ C++ ä¸­ä½¿ç”¨æ­¤ API ä¸å¿…å†åšä»»ä½•ç‰¹æ®Šå¤„ç†ã€‚</p>
</div>
<div class="section" id="useful-macros">
<h2>æœ‰ç”¨çš„å®<a class="headerlink" href="#useful-macros" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>Python å¤´æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€äº›æœ‰ç”¨çš„å®ã€‚è®¸å¤šæ˜¯åœ¨é è¿‘å®ƒä»¬è¢«ä½¿ç”¨çš„åœ°æ–¹å®šä¹‰çš„ï¼ˆä¾‹å¦‚ <a class="reference internal" href="none.html#c.Py_RETURN_NONE" tppabs="https://docs.python.org/zh-cn/3/c-api/none.html#c.Py_RETURN_NONE" title="Py_RETURN_NONE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_RETURN_NONE</span></code></a>ï¼‰ã€‚å…¶ä»–æ›´ä¸ºé€šç”¨çš„åˆ™å®šä¹‰åœ¨è¿™é‡Œã€‚è¿™é‡Œæ‰€æ˜¾ç¤ºçš„å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„åˆ—è¡¨ã€‚</p>
<dl class="macro">
<dt id="c.Py_UNREACHABLE">
<code class="descname">Py_UNREACHABLE</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#c.Py_UNREACHABLE" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>è¿™ä¸ªå¯ä»¥åœ¨ä½ æœ‰ä¸€ä¸ªä¸æ‰“ç®—è¢«è§¦åŠçš„ä»£ç è·¯å¾„æ—¶ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ª <code class="docutils literal notranslate"><span class="pre">switch</span></code> è¯­å¥ä¸­æ‰€æœ‰å¯èƒ½çš„å€¼éƒ½å·²è¢« <code class="docutils literal notranslate"><span class="pre">case</span></code> å­å¥è¦†ç›–äº†ï¼Œå°±å¯å°†å…¶ç”¨åœ¨ <code class="docutils literal notranslate"><span class="pre">default:</span></code> å­å¥ä¸­ã€‚å½“ä½ éå¸¸æƒ³åœ¨æŸä¸ªä½ç½®æ”¾ä¸€ä¸ª <code class="docutils literal notranslate"><span class="pre">assert(0)</span></code> æˆ– <code class="docutils literal notranslate"><span class="pre">abort()</span></code> è°ƒç”¨æ—¶ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªã€‚</p>
<div class="versionadded">
<p><span class="versionmodified">3.7 æ–°ç‰ˆåŠŸèƒ½.</span></p>
</div>
</dd></dl>

<dl class="macro">
<dt id="c.Py_ABS">
<code class="descname">Py_ABS</code><span class="sig-paren">(</span>x<span class="sig-paren">)</span><a class="headerlink" href="#c.Py_ABS" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>è¿”å› <code class="docutils literal notranslate"><span class="pre">x</span></code> çš„ç»å¯¹å€¼ã€‚</p>
<div class="versionadded">
<p><span class="versionmodified">3.3 æ–°ç‰ˆåŠŸèƒ½.</span></p>
</div>
</dd></dl>

<dl class="macro">
<dt id="c.Py_MIN">
<code class="descname">Py_MIN</code><span class="sig-paren">(</span>x, y<span class="sig-paren">)</span><a class="headerlink" href="#c.Py_MIN" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>è¿”å› <code class="docutils literal notranslate"><span class="pre">x</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">y</span></code> å½“ä¸­çš„æœ€å°å€¼ã€‚</p>
<div class="versionadded">
<p><span class="versionmodified">3.3 æ–°ç‰ˆåŠŸèƒ½.</span></p>
</div>
</dd></dl>

<dl class="macro">
<dt id="c.Py_MAX">
<code class="descname">Py_MAX</code><span class="sig-paren">(</span>x, y<span class="sig-paren">)</span><a class="headerlink" href="#c.Py_MAX" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>è¿”å› <code class="docutils literal notranslate"><span class="pre">x</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">y</span></code> å½“ä¸­çš„æœ€å¤§å€¼ã€‚</p>
<div class="versionadded">
<p><span class="versionmodified">3.3 æ–°ç‰ˆåŠŸèƒ½.</span></p>
</div>
</dd></dl>

<dl class="macro">
<dt id="c.Py_STRINGIFY">
<code class="descname">Py_STRINGIFY</code><span class="sig-paren">(</span>x<span class="sig-paren">)</span><a class="headerlink" href="#c.Py_STRINGIFY" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>å°† <code class="docutils literal notranslate"><span class="pre">x</span></code> è½¬æ¢ä¸º C å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ <code class="docutils literal notranslate"><span class="pre">Py_STRINGIFY(123)</span></code> è¿”å› <code class="docutils literal notranslate"><span class="pre">&quot;123&quot;</span></code>ã€‚</p>
<div class="versionadded">
<p><span class="versionmodified">3.4 æ–°ç‰ˆåŠŸèƒ½.</span></p>
</div>
</dd></dl>

<dl class="macro">
<dt id="c.Py_MEMBER_SIZE">
<code class="descname">Py_MEMBER_SIZE</code><span class="sig-paren">(</span>type, member<span class="sig-paren">)</span><a class="headerlink" href="#c.Py_MEMBER_SIZE" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>è¿”å›ç»“æ„ (<code class="docutils literal notranslate"><span class="pre">type</span></code>) <code class="docutils literal notranslate"><span class="pre">member</span></code> çš„å¤§å°ï¼Œä»¥å­—èŠ‚è¡¨ç¤ºã€‚</p>
<div class="versionadded">
<p><span class="versionmodified">3.6 æ–°ç‰ˆåŠŸèƒ½.</span></p>
</div>
</dd></dl>

<dl class="macro">
<dt id="c.Py_CHARMASK">
<code class="descname">Py_CHARMASK</code><span class="sig-paren">(</span>c<span class="sig-paren">)</span><a class="headerlink" href="#c.Py_CHARMASK" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>å‚æ•°å¿…é¡»ä¸º [-128, 127] æˆ– [0, 255] èŒƒå›´å†…çš„å­—ç¬¦æˆ–æ•´æ•°ç±»å‹ã€‚è¿™ä¸ªå®å°† <code class="docutils literal notranslate"><span class="pre">c</span></code> å¼ºåˆ¶è½¬æ¢ä¸º <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span></code> è¿”å›ã€‚</p>
</dd></dl>

<dl class="macro">
<dt id="c.Py_GETENV">
<code class="descname">Py_GETENV</code><span class="sig-paren">(</span>s<span class="sig-paren">)</span><a class="headerlink" href="#c.Py_GETENV" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>ç±»ä¼¼ <code class="docutils literal notranslate"><span class="pre">getenv(s)</span></code> ä½†ä¼šåœ¨ä»¥ä¸‹æƒ…å†µè¿”å› <em>NULL</em> ï¼šå¦‚æœé€šè¿‡å‘½ä»¤è¡Œä¼ å…¥ <a class="reference internal" href="cmdline.html#cmdoption-e" tppabs="https://docs.python.org/zh-cn/3/using/cmdline.html#cmdoption-e"><code class="xref std std-option docutils literal notranslate"><span class="pre">-E</span></code></a> ï¼ˆå³è®¾ç½®äº† <code class="docutils literal notranslate"><span class="pre">Py_IgnoreEnvironmentFlag</span></code> ï¼‰ã€‚</p>
</dd></dl>

<dl class="macro">
<dt id="c.Py_UNUSED">
<code class="descname">Py_UNUSED</code><span class="sig-paren">(</span>arg<span class="sig-paren">)</span><a class="headerlink" href="#c.Py_UNUSED" title="æ°¸ä¹…é“¾æ¥è‡³ç›®æ ‡">Â¶</a></dt>
<dd><p>è¿™ä¸ªå¯ç”¨äºå‡½æ•°å®šä¹‰ä¸­æœªä½¿ç”¨çš„å‚æ•°ä»¥éšè—ç¼–è¯‘å™¨è­¦å‘Šï¼Œä¾‹å¦‚ <code class="docutils literal notranslate"><span class="pre">PyObject*</span> <span class="pre">func(PyObject</span> <span class="pre">*Py_UNUSED(ignored))</span></code>ã€‚</p>
<div class="versionadded">
<p><span class="versionmodified">3.4 æ–°ç‰ˆåŠŸèƒ½.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="objects-types-and-reference-counts">
<span id="api-objects"></span><h2>å¯¹è±¡ã€ç±»å‹å’Œå¼•ç”¨è®¡æ•°<a class="headerlink" href="#objects-types-and-reference-counts" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p id="index-6">å¤§å¤šæ•° Python/C API å‡½æ•°éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ä»¥åŠä¸€ä¸ª <a class="reference internal" href="structures.html#c.PyObject" tppabs="https://docs.python.org/zh-cn/3/c-api/structures.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyObject*</span></code></a> ç±»å‹çš„è¿”å›å€¼ã€‚æ­¤ç±»å‹æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘è¡¨ç¤ºä¸€ä¸ªä»»æ„ Python å¯¹è±¡çš„ä¸é€æ˜æ•°æ®ç±»å‹ã€‚ç”±äºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚èµ‹å€¼ã€ä½œç”¨åŸŸè§„åˆ™å’Œå‚æ•°ä¼ é€’ï¼‰ Python è¯­è¨€éƒ½ä¼šä»¥åŒæ ·çš„æ–¹å¼å¤„ç†æ‰€æœ‰ Python å¯¹è±¡ç±»å‹ï¼Œå› æ­¤å®ƒä»¬ç”±ä¸€ä¸ªå•ç‹¬çš„ C ç±»å‹æ¥è¡¨ç¤ºæ˜¯å¾ˆé€‚å®œçš„ã€‚å‡ ä¹æ‰€æœ‰ Python å¯¹è±¡éƒ½ç”Ÿå­˜åœ¨å †ä¸Šï¼šä½ ç»ä¸ä¼šå£°æ˜ä¸€ä¸ª <a class="reference internal" href="structures.html#c.PyObject" tppabs="https://docs.python.org/zh-cn/3/c-api/structures.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyObject</span></code></a> ç±»å‹çš„è‡ªåŠ¨æˆ–é™æ€å˜é‡ï¼Œåªæœ‰ <a class="reference internal" href="structures.html#c.PyObject" tppabs="https://docs.python.org/zh-cn/3/c-api/structures.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyObject*</span></code></a> ç±»å‹çš„æŒ‡é’ˆå˜é‡å¯ä»¥è¢«å£°æ˜ã€‚å”¯ä¸€çš„ä¾‹å¤–æ˜¯ type å¯¹è±¡ï¼›ç”±äºæ­¤ç§å¯¹è±¡æ°¸è¿œä¸èƒ½è¢«é‡Šæ”¾ï¼Œæ‰€ä»¥å®ƒä»¬é€šå¸¸æ˜¯é™æ€ <a class="reference internal" href="type.html#c.PyTypeObject" tppabs="https://docs.python.org/zh-cn/3/c-api/type.html#c.PyTypeObject" title="PyTypeObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyTypeObject</span></code></a> å¯¹è±¡ã€‚</p>
<p>æ‰€æœ‰ Python å¯¹è±¡ï¼ˆç”šè‡³ Python æ•´æ•°ï¼‰éƒ½æœ‰ä¸€ä¸ª <em class="dfn">type</em> å’Œä¸€ä¸ª <em class="dfn">reference count</em>ã€‚å¯¹è±¡çš„ç±»å‹ç¡®å®šå®ƒæ˜¯ä»€ä¹ˆç±»å‹çš„å¯¹è±¡ï¼ˆä¾‹å¦‚æ•´æ•°ã€åˆ—è¡¨æˆ–ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼›è¿˜æœ‰æ›´å¤šï¼Œå¦‚ <a class="reference internal" href="datamodel.html#types" tppabs="https://docs.python.org/zh-cn/3/reference/datamodel.html#types"><span class="std std-ref">æ ‡å‡†ç±»å‹å±‚çº§ç»“æ„</span></a> ä¸­æ‰€è¿°ï¼‰ã€‚å¯¹äºæ¯ä¸ªä¼—æ‰€å‘¨çŸ¥çš„ç±»å‹ï¼Œéƒ½æœ‰ä¸€ä¸ªå®æ¥æ£€æŸ¥å¯¹è±¡æ˜¯å¦å±äºè¯¥ç±»å‹ï¼›ä¾‹å¦‚ï¼Œå½“ï¼ˆä¸”ä»…å½“ï¼‰ <em>a</em> æ‰€æŒ‡çš„å¯¹è±¡æ˜¯ Python åˆ—è¡¨æ—¶ <code class="docutils literal notranslate"><span class="pre">PyList_Check(a)</span></code> ä¸ºçœŸã€‚</p>
<div class="section" id="reference-counts">
<span id="api-refcounts"></span><h3>å¼•ç”¨è®¡æ•°<a class="headerlink" href="#reference-counts" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>The reference count is important because today's computers have a  finite (and
often severely limited) memory size; it counts how many  different places there
are that have a reference to an object.  Such a  place could be another object,
or a global (or static) C variable, or  a local variable in some C function.
When an object's reference count  becomes zero, the object is deallocated.  If
it contains references to  other objects, their reference count is decremented.
Those other  objects may be deallocated in turn, if this decrement makes their
reference count become zero, and so on.  (There's an obvious problem  with
objects that reference each other here; for now, the solution is  &quot;don't do
that.&quot;)</p>
<p id="index-7">Reference counts are always manipulated explicitly.  The normal way is  to use
the macro <a class="reference internal" href="refcounting.html#c.Py_INCREF" tppabs="https://docs.python.org/zh-cn/3/c-api/refcounting.html#c.Py_INCREF" title="Py_INCREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_INCREF()</span></code></a> to increment an object's reference count by one,
and <a class="reference internal" href="refcounting.html#c.Py_DECREF" tppabs="https://docs.python.org/zh-cn/3/c-api/refcounting.html#c.Py_DECREF" title="Py_DECREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_DECREF()</span></code></a> to decrement it by   one.  The <a class="reference internal" href="refcounting.html#c.Py_DECREF" tppabs="https://docs.python.org/zh-cn/3/c-api/refcounting.html#c.Py_DECREF" title="Py_DECREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_DECREF()</span></code></a> macro
is considerably more complex than the incref one, since it must check whether
the reference count becomes zero and then cause the object's deallocator to be
called. The deallocator is a function pointer contained in the object's type
structure.  The type-specific deallocator takes care of decrementing the
reference counts for other objects contained in the object if this is a compound
object type, such as a list, as well as performing any additional finalization
that's needed.  There's no chance that the reference count can overflow; at
least as many bits are used to hold the reference count as there are distinct
memory locations in virtual memory (assuming <code class="docutils literal notranslate"><span class="pre">sizeof(Py_ssize_t)</span> <span class="pre">&gt;=</span> <span class="pre">sizeof(void*)</span></code>).
Thus, the reference count increment is a simple operation.</p>
<p>It is not necessary to increment an object's reference count for every  local
variable that contains a pointer to an object.  In theory, the  object's
reference count goes up by one when the variable is made to  point to it and it
goes down by one when the variable goes out of  scope.  However, these two
cancel each other out, so at the end the  reference count hasn't changed.  The
only real reason to use the  reference count is to prevent the object from being
deallocated as  long as our variable is pointing to it.  If we know that there
is at  least one other reference to the object that lives at least as long as
our variable, there is no need to increment the reference count  temporarily.
An important situation where this arises is in objects  that are passed as
arguments to C functions in an extension module  that are called from Python;
the call mechanism guarantees to hold a  reference to every argument for the
duration of the call.</p>
<p>However, a common pitfall is to extract an object from a list and hold on to it
for a while without incrementing its reference count. Some other operation might
conceivably remove the object from the list, decrementing its reference count
and possible deallocating it. The real danger is that innocent-looking
operations may invoke arbitrary Python code which could do this; there is a code
path which allows control to flow back to the user from a <a class="reference internal" href="refcounting.html#c.Py_DECREF" tppabs="https://docs.python.org/zh-cn/3/c-api/refcounting.html#c.Py_DECREF" title="Py_DECREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_DECREF()</span></code></a>, so
almost any operation is potentially dangerous.</p>
<p>A safe approach is to always use the generic operations (functions  whose name
begins with <code class="docutils literal notranslate"><span class="pre">PyObject_</span></code>, <code class="docutils literal notranslate"><span class="pre">PyNumber_</span></code>, <code class="docutils literal notranslate"><span class="pre">PySequence_</span></code> or <code class="docutils literal notranslate"><span class="pre">PyMapping_</span></code>).
These operations always increment the reference count of the object they return.
This leaves the caller with the responsibility to call <a class="reference internal" href="refcounting.html#c.Py_DECREF" tppabs="https://docs.python.org/zh-cn/3/c-api/refcounting.html#c.Py_DECREF" title="Py_DECREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_DECREF()</span></code></a> when
they are done with the result; this soon becomes second nature.</p>
<div class="section" id="reference-count-details">
<span id="api-refcountdetails"></span><h4>Reference Count Details<a class="headerlink" href="#reference-count-details" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h4>
<p>The reference count behavior of functions in the Python/C API is best  explained
in terms of <em>ownership of references</em>.  Ownership pertains to references, never
to objects (objects are not owned: they are always shared).  &quot;Owning a
reference&quot; means being responsible for calling Py_DECREF on it when the
reference is no longer needed.  Ownership can also be transferred, meaning that
the code that receives ownership of the reference then becomes responsible for
eventually decref'ing it by calling <a class="reference internal" href="refcounting.html#c.Py_DECREF" tppabs="https://docs.python.org/zh-cn/3/c-api/refcounting.html#c.Py_DECREF" title="Py_DECREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_DECREF()</span></code></a> or <a class="reference internal" href="refcounting.html#c.Py_XDECREF" tppabs="https://docs.python.org/zh-cn/3/c-api/refcounting.html#c.Py_XDECREF" title="Py_XDECREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_XDECREF()</span></code></a>
when it's no longer needed---or passing on this responsibility (usually to its
caller). When a function passes ownership of a reference on to its caller, the
caller is said to receive a <em>new</em> reference.  When no ownership is transferred,
the caller is said to <em>borrow</em> the reference. Nothing needs to be done for a
borrowed reference.</p>
<p>Conversely, when a calling function passes in a reference to an  object, there
are two possibilities: the function <em>steals</em> a  reference to the object, or it
does not.  <em>Stealing a reference</em> means that when you pass a reference to a
function, that function assumes that it now owns that reference, and you are not
responsible for it any longer.</p>
<p id="index-8">Few functions steal references; the two notable exceptions are
<a class="reference internal" href="list.html#c.PyList_SetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/list.html#c.PyList_SetItem" title="PyList_SetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyList_SetItem()</span></code></a> and <a class="reference internal" href="tuple.html#c.PyTuple_SetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/tuple.html#c.PyTuple_SetItem" title="PyTuple_SetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyTuple_SetItem()</span></code></a>, which  steal a reference
to the item (but not to the tuple or list into which the item is put!).  These
functions were designed to steal a reference because of a common idiom for
populating a tuple or list with newly created objects; for example, the code to
create the tuple <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">2,</span> <span class="pre">&quot;three&quot;)</span></code> could look like this (forgetting about
error handling for the moment; a better way to code this is shown below):</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PyObject</span> <span class="o">*</span><span class="n">t</span><span class="p">;</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">PyTuple_New</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="n">PyTuple_SetItem</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">PyLong_FromLong</span><span class="p">(</span><span class="mi">1L</span><span class="p">));</span>
<span class="n">PyTuple_SetItem</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PyLong_FromLong</span><span class="p">(</span><span class="mi">2L</span><span class="p">));</span>
<span class="n">PyTuple_SetItem</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PyUnicode_FromString</span><span class="p">(</span><span class="s">&quot;three&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>Here, <a class="reference internal" href="long.html#c.PyLong_FromLong" tppabs="https://docs.python.org/zh-cn/3/c-api/long.html#c.PyLong_FromLong" title="PyLong_FromLong"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyLong_FromLong()</span></code></a> returns a new reference which is immediately
stolen by <a class="reference internal" href="tuple.html#c.PyTuple_SetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/tuple.html#c.PyTuple_SetItem" title="PyTuple_SetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyTuple_SetItem()</span></code></a>.  When you want to keep using an object
although the reference to it will be stolen, use <a class="reference internal" href="refcounting.html#c.Py_INCREF" tppabs="https://docs.python.org/zh-cn/3/c-api/refcounting.html#c.Py_INCREF" title="Py_INCREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_INCREF()</span></code></a> to grab
another reference before calling the reference-stealing function.</p>
<p>Incidentally, <a class="reference internal" href="tuple.html#c.PyTuple_SetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/tuple.html#c.PyTuple_SetItem" title="PyTuple_SetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyTuple_SetItem()</span></code></a> is the <em>only</em> way to set tuple items;
<a class="reference internal" href="sequence.html#c.PySequence_SetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/sequence.html#c.PySequence_SetItem" title="PySequence_SetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PySequence_SetItem()</span></code></a> and <a class="reference internal" href="object.html#c.PyObject_SetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/object.html#c.PyObject_SetItem" title="PyObject_SetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_SetItem()</span></code></a> refuse to do this
since tuples are an immutable data type.  You should only use
<a class="reference internal" href="tuple.html#c.PyTuple_SetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/tuple.html#c.PyTuple_SetItem" title="PyTuple_SetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyTuple_SetItem()</span></code></a> for tuples that you are creating yourself.</p>
<p>Equivalent code for populating a list can be written using <a class="reference internal" href="list.html#c.PyList_New" tppabs="https://docs.python.org/zh-cn/3/c-api/list.html#c.PyList_New" title="PyList_New"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyList_New()</span></code></a>
and <a class="reference internal" href="list.html#c.PyList_SetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/list.html#c.PyList_SetItem" title="PyList_SetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyList_SetItem()</span></code></a>.</p>
<p>However, in practice, you will rarely use these ways of creating and populating
a tuple or list.  There's a generic function, <a class="reference internal" href="arg.html#c.Py_BuildValue" tppabs="https://docs.python.org/zh-cn/3/c-api/arg.html#c.Py_BuildValue" title="Py_BuildValue"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_BuildValue()</span></code></a>, that can
create most common objects from C values, directed by a <em class="dfn">format string</em>.
For example, the above two blocks of code could be replaced by the following
(which also takes care of the error checking):</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PyObject</span> <span class="o">*</span><span class="n">tuple</span><span class="p">,</span> <span class="o">*</span><span class="n">list</span><span class="p">;</span>

<span class="n">tuple</span> <span class="o">=</span> <span class="n">Py_BuildValue</span><span class="p">(</span><span class="s">&quot;(iis)&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;three&quot;</span><span class="p">);</span>
<span class="n">list</span> <span class="o">=</span> <span class="n">Py_BuildValue</span><span class="p">(</span><span class="s">&quot;[iis]&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;three&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>It is much more common to use <a class="reference internal" href="object.html#c.PyObject_SetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/object.html#c.PyObject_SetItem" title="PyObject_SetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_SetItem()</span></code></a> and friends with items
whose references you are only borrowing, like arguments that were passed in to
the function you are writing.  In that case, their behaviour regarding reference
counts is much saner, since you don't have to increment a reference count so you
can give a reference away (&quot;have it be stolen&quot;).  For example, this function
sets all items of a list (actually, any mutable sequence) to a given item:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>
<span class="nf">set_all</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">target</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Py_ssize_t</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">PyObject_Length</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">PyObject</span> <span class="o">*</span><span class="n">index</span> <span class="o">=</span> <span class="n">PyLong_FromSsize_t</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">index</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">PyObject_SetItem</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="index-9">The situation is slightly different for function return values.   While passing
a reference to most functions does not change your  ownership responsibilities
for that reference, many functions that  return a reference to an object give
you ownership of the reference. The reason is simple: in many cases, the
returned object is created  on the fly, and the reference you get is the only
reference to the  object.  Therefore, the generic functions that return object
references, like <a class="reference internal" href="object.html#c.PyObject_GetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/object.html#c.PyObject_GetItem" title="PyObject_GetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_GetItem()</span></code></a> and  <a class="reference internal" href="sequence.html#c.PySequence_GetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/sequence.html#c.PySequence_GetItem" title="PySequence_GetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PySequence_GetItem()</span></code></a>,
always return a new reference (the caller becomes the owner of the reference).</p>
<p>It is important to realize that whether you own a reference returned  by a
function depends on which function you call only --- <em>the plumage</em> (the type of
the object passed as an argument to the function) <em>doesn't enter into it!</em>
Thus, if you  extract an item from a list using <a class="reference internal" href="list.html#c.PyList_GetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/list.html#c.PyList_GetItem" title="PyList_GetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyList_GetItem()</span></code></a>, you
don't own the reference --- but if you obtain the same item from the same list
using <a class="reference internal" href="sequence.html#c.PySequence_GetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/sequence.html#c.PySequence_GetItem" title="PySequence_GetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PySequence_GetItem()</span></code></a> (which happens to take exactly the same
arguments), you do own a reference to the returned object.</p>
<p id="index-10">Here is an example of how you could write a function that computes the sum of
the items in a list of integers; once using  <a class="reference internal" href="list.html#c.PyList_GetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/list.html#c.PyList_GetItem" title="PyList_GetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyList_GetItem()</span></code></a>, and once
using <a class="reference internal" href="sequence.html#c.PySequence_GetItem" tppabs="https://docs.python.org/zh-cn/3/c-api/sequence.html#c.PySequence_GetItem" title="PySequence_GetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PySequence_GetItem()</span></code></a>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">long</span>
<span class="nf">sum_list</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">list</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Py_ssize_t</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="p">;</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">item</span><span class="p">;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">PyList_Size</span><span class="p">(</span><span class="n">list</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* Not a list */</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">PyList_GetItem</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> <span class="cm">/* Can&#39;t fail */</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyLong_Check</span><span class="p">(</span><span class="n">item</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span> <span class="cm">/* Skip non-integers */</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">PyLong_AsLong</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">PyErr_Occurred</span><span class="p">())</span>
            <span class="cm">/* Integer too big to fit in a C long, bail out */</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">total</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate" id="index-11"><div class="highlight"><pre><span></span><span class="kt">long</span>
<span class="nf">sum_sequence</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">sequence</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Py_ssize_t</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="p">;</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">item</span><span class="p">;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">PySequence_Length</span><span class="p">(</span><span class="n">sequence</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* Has no length */</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">PySequence_GetItem</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* Not a sequence, or other failure */</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">PyLong_Check</span><span class="p">(</span><span class="n">item</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">PyLong_AsLong</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
            <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">PyErr_Occurred</span><span class="p">())</span>
                <span class="cm">/* Integer too big to fit in a C long, bail out */</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">value</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">item</span><span class="p">);</span> <span class="cm">/* Discard reference ownership */</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">total</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="types">
<span id="api-types"></span><span id="index-12"></span><h3>ç±»å‹<a class="headerlink" href="#types" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>There are few other data types that play a significant role in  the Python/C
API; most are simple C types such as <code class="xref c c-type docutils literal notranslate"><span class="pre">int</span></code>,  <code class="xref c c-type docutils literal notranslate"><span class="pre">long</span></code>,
<code class="xref c c-type docutils literal notranslate"><span class="pre">double</span></code> and <code class="xref c c-type docutils literal notranslate"><span class="pre">char*</span></code>.  A few structure types  are used to
describe static tables used to list the functions exported  by a module or the
data attributes of a new object type, and another is used to describe the value
of a complex number.  These will  be discussed together with the functions that
use them.</p>
</div>
</div>
<div class="section" id="exceptions">
<span id="api-exceptions"></span><h2>å¼‚å¸¸<a class="headerlink" href="#exceptions" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>Pythonç¨‹åºå‘˜åªéœ€è¦å¤„ç†ç‰¹å®šéœ€è¦å¤„ç†çš„é”™è¯¯å¼‚å¸¸ï¼›æœªå¤„ç†çš„å¼‚å¸¸ä¼šè‡ªåŠ¨ä¼ é€’ç»™è°ƒç”¨è€…ï¼Œç„¶åä¼ é€’ç»™è°ƒç”¨è€…çš„è°ƒç”¨è€…ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°ä»–ä»¬åˆ°è¾¾é¡¶çº§è§£é‡Šå™¨ï¼Œåœ¨é‚£é‡Œå°†å®ƒä»¬æŠ¥å‘Šç»™ç”¨æˆ·å¹¶ä¼´éšå †æ ˆå›æº¯ã€‚</p>
<p id="index-13">For C programmers, however, error checking always has to be explicit.  All
functions in the Python/C API can raise exceptions, unless an explicit claim is
made otherwise in a function's documentation.  In general, when a function
encounters an error, it sets an exception, discards any object references that
it owns, and returns an error indicator.  If not documented otherwise, this
indicator is either <em>NULL</em> or <code class="docutils literal notranslate"><span class="pre">-1</span></code>, depending on the function's return type.
A few functions return a Boolean true/false result, with false indicating an
error.  Very few functions return no explicit error indicator or have an
ambiguous return value, and require explicit testing for errors with
<a class="reference internal" href="exceptions-1.html#c.PyErr_Occurred" tppabs="https://docs.python.org/zh-cn/3/c-api/exceptions.html#c.PyErr_Occurred" title="PyErr_Occurred"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Occurred()</span></code></a>.  These exceptions are always explicitly documented.</p>
<p id="index-14">Exception state is maintained in per-thread storage (this is  equivalent to
using global storage in an unthreaded application).  A  thread can be in one of
two states: an exception has occurred, or not. The function
<a class="reference internal" href="exceptions-1.html#c.PyErr_Occurred" tppabs="https://docs.python.org/zh-cn/3/c-api/exceptions.html#c.PyErr_Occurred" title="PyErr_Occurred"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Occurred()</span></code></a> can be used to check for this: it returns a borrowed
reference to the exception type object when an exception has occurred, and
<em>NULL</em> otherwise.  There are a number of functions to set the exception state:
<a class="reference internal" href="exceptions-1.html#c.PyErr_SetString" tppabs="https://docs.python.org/zh-cn/3/c-api/exceptions.html#c.PyErr_SetString" title="PyErr_SetString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_SetString()</span></code></a> is the most common (though not the most general)
function to set the exception state, and <a class="reference internal" href="exceptions-1.html#c.PyErr_Clear" tppabs="https://docs.python.org/zh-cn/3/c-api/exceptions.html#c.PyErr_Clear" title="PyErr_Clear"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Clear()</span></code></a> clears the
exception state.</p>
<p>The full exception state consists of three objects (all of which can  be
<em>NULL</em>): the exception type, the corresponding exception  value, and the
traceback.  These have the same meanings as the Python result of
<code class="docutils literal notranslate"><span class="pre">sys.exc_info()</span></code>; however, they are not the same: the Python objects represent
the last exception being handled by a Python  <a class="reference internal" href="compound_stmts.html#try" tppabs="https://docs.python.org/zh-cn/3/reference/compound_stmts.html#try"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">try</span></code></a> ...
<a class="reference internal" href="compound_stmts.html#except" tppabs="https://docs.python.org/zh-cn/3/reference/compound_stmts.html#except"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">except</span></code></a> statement, while the C level exception state only exists while
an exception is being passed on between C functions until it reaches the Python
bytecode interpreter's  main loop, which takes care of transferring it to
<code class="docutils literal notranslate"><span class="pre">sys.exc_info()</span></code> and friends.</p>
<p id="index-15">Note that starting with Python 1.5, the preferred, thread-safe way to access the
exception state from Python code is to call the function <a class="reference internal" href="sys.html#sys.exc_info" tppabs="https://docs.python.org/zh-cn/3/library/sys.html#sys.exc_info" title="sys.exc_info"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.exc_info()</span></code></a>,
which returns the per-thread exception state for Python code.  Also, the
semantics of both ways to access the exception state have changed so that a
function which catches an exception will save and restore its thread's exception
state so as to preserve the exception state of its caller.  This prevents common
bugs in exception handling code caused by an innocent-looking function
overwriting the exception being handled; it also reduces the often unwanted
lifetime extension for objects that are referenced by the stack frames in the
traceback.</p>
<p>As a general principle, a function that calls another function to  perform some
task should check whether the called function raised an  exception, and if so,
pass the exception state on to its caller.  It  should discard any object
references that it owns, and return an  error indicator, but it should <em>not</em> set
another exception --- that would overwrite the exception that was just raised,
and lose important information about the exact cause of the error.</p>
<p id="index-16">A simple example of detecting exceptions and passing them on is shown in the
<code class="xref c c-func docutils literal notranslate"><span class="pre">sum_sequence()</span></code> example above.  It so happens that this example doesn't
need to clean up any owned references when it detects an error.  The following
example function shows some error cleanup.  First, to remind you why you like
Python, we show the equivalent Python code:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">def</span> <span class="n">incr_item</span><span class="p">(</span><span class="n">dict</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span><span class="o">:</span>
    <span class="nl">try</span><span class="p">:</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">except</span> <span class="nl">KeyError</span><span class="p">:</span>
        <span class="n">item</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p id="index-17">Here is the corresponding C code, in all its glory:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>
<span class="nf">incr_item</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">dict</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">key</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/* Objects all initialized to NULL for Py_XDECREF */</span>
    <span class="n">PyObject</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">*</span><span class="n">const_one</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">*</span><span class="n">incremented_item</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">rv</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* Return value initialized to -1 (failure) */</span>

    <span class="n">item</span> <span class="o">=</span> <span class="n">PyObject_GetItem</span><span class="p">(</span><span class="n">dict</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* Handle KeyError only: */</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyErr_ExceptionMatches</span><span class="p">(</span><span class="n">PyExc_KeyError</span><span class="p">))</span>
            <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>

        <span class="cm">/* Clear the error and use zero: */</span>
        <span class="n">PyErr_Clear</span><span class="p">();</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">PyLong_FromLong</span><span class="p">(</span><span class="mi">0L</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">const_one</span> <span class="o">=</span> <span class="n">PyLong_FromLong</span><span class="p">(</span><span class="mi">1L</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">const_one</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>

    <span class="n">incremented_item</span> <span class="o">=</span> <span class="n">PyNumber_Add</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">const_one</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">incremented_item</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">PyObject_SetItem</span><span class="p">(</span><span class="n">dict</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">incremented_item</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* Success */</span>
    <span class="cm">/* Continue with cleanup code */</span>

 <span class="nl">error</span><span class="p">:</span>
    <span class="cm">/* Cleanup code, shared by success and failure path */</span>

    <span class="cm">/* Use Py_XDECREF() to ignore NULL references */</span>
    <span class="n">Py_XDECREF</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
    <span class="n">Py_XDECREF</span><span class="p">(</span><span class="n">const_one</span><span class="p">);</span>
    <span class="n">Py_XDECREF</span><span class="p">(</span><span class="n">incremented_item</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">rv</span><span class="p">;</span> <span class="cm">/* -1 for error, 0 for success */</span>
<span class="p">}</span>
</pre></div>
</div>
<span class="target" id="index-18"></span><p id="index-19">This example represents an endorsed use of the <code class="docutils literal notranslate"><span class="pre">goto</span></code> statement  in C!
It illustrates the use of <a class="reference internal" href="exceptions-1.html#c.PyErr_ExceptionMatches" tppabs="https://docs.python.org/zh-cn/3/c-api/exceptions.html#c.PyErr_ExceptionMatches" title="PyErr_ExceptionMatches"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_ExceptionMatches()</span></code></a> and
<a class="reference internal" href="exceptions-1.html#c.PyErr_Clear" tppabs="https://docs.python.org/zh-cn/3/c-api/exceptions.html#c.PyErr_Clear" title="PyErr_Clear"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Clear()</span></code></a> to handle specific exceptions, and the use of
<a class="reference internal" href="refcounting.html#c.Py_XDECREF" tppabs="https://docs.python.org/zh-cn/3/c-api/refcounting.html#c.Py_XDECREF" title="Py_XDECREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_XDECREF()</span></code></a> to dispose of owned references that may be <em>NULL</em> (note the
<code class="docutils literal notranslate"><span class="pre">'X'</span></code> in the name; <a class="reference internal" href="refcounting.html#c.Py_DECREF" tppabs="https://docs.python.org/zh-cn/3/c-api/refcounting.html#c.Py_DECREF" title="Py_DECREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_DECREF()</span></code></a> would crash when confronted with a
<em>NULL</em> reference).  It is important that the variables used to hold owned
references are initialized to <em>NULL</em> for this to work; likewise, the proposed
return value is initialized to <code class="docutils literal notranslate"><span class="pre">-1</span></code> (failure) and only set to success after
the final call made is successful.</p>
</div>
<div class="section" id="embedding-python">
<span id="api-embedding"></span><h2>åµŒå…¥Python<a class="headerlink" href="#embedding-python" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>The one important task that only embedders (as opposed to extension writers) of
the Python interpreter have to worry about is the initialization, and possibly
the finalization, of the Python interpreter.  Most functionality of the
interpreter can only be used after the interpreter has been initialized.</p>
<p id="index-20">The basic initialization function is <a class="reference internal" href="init.html#c.Py_Initialize" tppabs="https://docs.python.org/zh-cn/3/c-api/init.html#c.Py_Initialize" title="Py_Initialize"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_Initialize()</span></code></a>. This initializes
the table of loaded modules, and creates the fundamental modules
<a class="reference internal" href="builtins.html#module-builtins" tppabs="https://docs.python.org/zh-cn/3/library/builtins.html#module-builtins" title="builtins: The module that provides the built-in namespace."><code class="xref py py-mod docutils literal notranslate"><span class="pre">builtins</span></code></a>, <a class="reference internal" href="__main__.html#module-__main__" tppabs="https://docs.python.org/zh-cn/3/library/__main__.html#module-__main__" title="__main__: The environment where the top-level script is run."><code class="xref py py-mod docutils literal notranslate"><span class="pre">__main__</span></code></a>, and <a class="reference internal" href="sys.html#module-sys" tppabs="https://docs.python.org/zh-cn/3/library/sys.html#module-sys" title="sys: Access system-specific parameters and functions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">sys</span></code></a>.  It also
initializes the module search path (<code class="docutils literal notranslate"><span class="pre">sys.path</span></code>).</p>
<p id="index-21"><a class="reference internal" href="init.html#c.Py_Initialize" tppabs="https://docs.python.org/zh-cn/3/c-api/init.html#c.Py_Initialize" title="Py_Initialize"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_Initialize()</span></code></a> does not set the &quot;script argument list&quot;  (<code class="docutils literal notranslate"><span class="pre">sys.argv</span></code>).
If this variable is needed by Python code that will be executed later, it must
be set explicitly with a call to  <code class="docutils literal notranslate"><span class="pre">PySys_SetArgvEx(argc,</span> <span class="pre">argv,</span> <span class="pre">updatepath)</span></code>
after the call to <a class="reference internal" href="init.html#c.Py_Initialize" tppabs="https://docs.python.org/zh-cn/3/c-api/init.html#c.Py_Initialize" title="Py_Initialize"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_Initialize()</span></code></a>.</p>
<p>On most systems (in particular, on Unix and Windows, although the details are
slightly different), <a class="reference internal" href="init.html#c.Py_Initialize" tppabs="https://docs.python.org/zh-cn/3/c-api/init.html#c.Py_Initialize" title="Py_Initialize"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_Initialize()</span></code></a> calculates the module search path
based upon its best guess for the location of the standard Python interpreter
executable, assuming that the Python library is found in a fixed location
relative to the Python interpreter executable.  In particular, it looks for a
directory named <code class="file docutils literal notranslate"><span class="pre">lib/python</span><em><span class="pre">X.Y</span></em></code> relative to the parent directory
where the executable named <code class="file docutils literal notranslate"><span class="pre">python</span></code> is found on the shell command search
path (the environment variable <span class="target" id="index-22"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code>).</p>
<p>For instance, if the Python executable is found in
<code class="file docutils literal notranslate"><span class="pre">/usr/local/bin/python</span></code>, it will assume that the libraries are in
<code class="file docutils literal notranslate"><span class="pre">/usr/local/lib/python</span><em><span class="pre">X.Y</span></em></code>.  (In fact, this particular path is also
the &quot;fallback&quot; location, used when no executable file named <code class="file docutils literal notranslate"><span class="pre">python</span></code> is
found along <span class="target" id="index-23"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code>.)  The user can override this behavior by setting the
environment variable <span class="target" id="index-24"></span><a class="reference internal" href="cmdline.html#envvar-PYTHONHOME" tppabs="https://docs.python.org/zh-cn/3/using/cmdline.html#envvar-PYTHONHOME"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONHOME</span></code></a>, or insert additional directories in
front of the standard path by setting <span class="target" id="index-25"></span><a class="reference internal" href="cmdline.html#envvar-PYTHONPATH" tppabs="https://docs.python.org/zh-cn/3/using/cmdline.html#envvar-PYTHONPATH"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code></a>.</p>
<p id="index-26">The embedding application can steer the search by calling
<code class="docutils literal notranslate"><span class="pre">Py_SetProgramName(file)</span></code> <em>before</em> calling  <a class="reference internal" href="init.html#c.Py_Initialize" tppabs="https://docs.python.org/zh-cn/3/c-api/init.html#c.Py_Initialize" title="Py_Initialize"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_Initialize()</span></code></a>.  Note that
<span class="target" id="index-27"></span><a class="reference internal" href="cmdline.html#envvar-PYTHONHOME" tppabs="https://docs.python.org/zh-cn/3/using/cmdline.html#envvar-PYTHONHOME"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONHOME</span></code></a> still overrides this and <span class="target" id="index-28"></span><a class="reference internal" href="cmdline.html#envvar-PYTHONPATH" tppabs="https://docs.python.org/zh-cn/3/using/cmdline.html#envvar-PYTHONPATH"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code></a> is still
inserted in front of the standard path.  An application that requires total
control has to provide its own implementation of <a class="reference internal" href="init.html#c.Py_GetPath" tppabs="https://docs.python.org/zh-cn/3/c-api/init.html#c.Py_GetPath" title="Py_GetPath"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetPath()</span></code></a>,
<a class="reference internal" href="init.html#c.Py_GetPrefix" tppabs="https://docs.python.org/zh-cn/3/c-api/init.html#c.Py_GetPrefix" title="Py_GetPrefix"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetPrefix()</span></code></a>, <a class="reference internal" href="init.html#c.Py_GetExecPrefix" tppabs="https://docs.python.org/zh-cn/3/c-api/init.html#c.Py_GetExecPrefix" title="Py_GetExecPrefix"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetExecPrefix()</span></code></a>, and
<a class="reference internal" href="init.html#c.Py_GetProgramFullPath" tppabs="https://docs.python.org/zh-cn/3/c-api/init.html#c.Py_GetProgramFullPath" title="Py_GetProgramFullPath"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetProgramFullPath()</span></code></a> (all defined in <code class="file docutils literal notranslate"><span class="pre">Modules/getpath.c</span></code>).</p>
<p id="index-29">Sometimes, it is desirable to &quot;uninitialize&quot; Python.  For instance,  the
application may want to start over (make another call to
<a class="reference internal" href="init.html#c.Py_Initialize" tppabs="https://docs.python.org/zh-cn/3/c-api/init.html#c.Py_Initialize" title="Py_Initialize"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_Initialize()</span></code></a>) or the application is simply done with its  use of
Python and wants to free memory allocated by Python.  This can be accomplished
by calling <a class="reference internal" href="init.html#c.Py_FinalizeEx" tppabs="https://docs.python.org/zh-cn/3/c-api/init.html#c.Py_FinalizeEx" title="Py_FinalizeEx"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_FinalizeEx()</span></code></a>.  The function <a class="reference internal" href="init.html#c.Py_IsInitialized" tppabs="https://docs.python.org/zh-cn/3/c-api/init.html#c.Py_IsInitialized" title="Py_IsInitialized"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_IsInitialized()</span></code></a> returns
true if Python is currently in the initialized state.  More information about
these functions is given in a later chapter. Notice that <a class="reference internal" href="init.html#c.Py_FinalizeEx" tppabs="https://docs.python.org/zh-cn/3/c-api/init.html#c.Py_FinalizeEx" title="Py_FinalizeEx"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_FinalizeEx()</span></code></a>
does <em>not</em> free all memory allocated by the Python interpreter, e.g. memory
allocated by extension modules currently cannot be released.</p>
</div>
<div class="section" id="debugging-builds">
<span id="api-debugging"></span><h2>è°ƒè¯•æ„å»º<a class="headerlink" href="#debugging-builds" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>Python can be built with several macros to enable extra checks of the
interpreter and extension modules.  These checks tend to add a large amount of
overhead to the runtime so they are not enabled by default.</p>
<p>A full list of the various types of debugging builds is in the file
<code class="file docutils literal notranslate"><span class="pre">Misc/SpecialBuilds.txt</span></code> in the Python source distribution. Builds are
available that support tracing of reference counts, debugging the memory
allocator, or low-level profiling of the main interpreter loop.  Only the most
frequently-used builds will be described in the remainder of this section.</p>
<p>Compiling the interpreter with the <code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_DEBUG</span></code> macro defined produces
what is generally meant by &quot;a debug build&quot; of Python. <code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_DEBUG</span></code> is
enabled in the Unix build by adding <code class="docutils literal notranslate"><span class="pre">--with-pydebug</span></code> to the
<code class="file docutils literal notranslate"><span class="pre">./configure</span></code> command.  It is also implied by the presence of the
not-Python-specific <code class="xref c c-macro docutils literal notranslate"><span class="pre">_DEBUG</span></code> macro.  When <code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_DEBUG</span></code> is enabled
in the Unix build, compiler optimization is disabled.</p>
<p>é™¤äº†å‰é¢æè¿°çš„å¼•ç”¨è®¡æ•°è°ƒè¯•ä¹‹å¤–ï¼Œè¿˜æ‰§è¡Œä»¥ä¸‹é¢å¤–æ£€æŸ¥ï¼š</p>
<ul class="simple">
<li>é¢å¤–æ£€æŸ¥å°†æ·»åŠ åˆ°å¯¹è±¡åˆ†é…å™¨ã€‚</li>
<li>é¢å¤–çš„æ£€æŸ¥å°†æ·»åŠ åˆ°è§£æå™¨å’Œç¼–è¯‘å™¨ä¸­ã€‚</li>
<li>Downcasts from wide types to narrow types are checked for loss of information.</li>
<li>è®¸å¤šæ–­è¨€è¢«æ·»åŠ åˆ°å­—å…¸å’Œé›†åˆå®ç°ä¸­ã€‚å¦å¤–ï¼Œé›†åˆå¯¹è±¡éœ€è¦ <code class="xref py py-meth docutils literal notranslate"><span class="pre">test_c_api()</span></code> æ–¹æ³•ã€‚</li>
<li>è¾“å…¥å‚æ•°çš„å®Œæ•´æ€§æ£€æŸ¥è¢«æ·»åŠ åˆ°æ¡†æ¶åˆ›å»ºä¸­ã€‚</li>
<li>ä½¿ç”¨å·²çŸ¥çš„æ— æ•ˆæ¨¡å¼åˆå§‹åŒ–æ•´å‹çš„å­˜å‚¨ï¼Œä»¥æ•è·å¯¹æœªåˆå§‹åŒ–æ•°å­—çš„å¼•ç”¨ã€‚</li>
<li>æ·»åŠ åº•å±‚è·Ÿè¸ªå’Œé¢å¤–çš„å¼‚å¸¸æ£€æŸ¥åˆ°è™šæ‹Ÿæœºçš„è¿è¡Œæ—¶ä¸­ã€‚</li>
<li>Extra checks are added to the memory arena implementation.</li>
<li>æ·»åŠ é¢å¤–è°ƒè¯•åˆ°çº¿ç¨‹æ¨¡å—ã€‚</li>
</ul>
<p>è¿™é‡Œå¯èƒ½æ²¡æœ‰æåˆ°çš„é¢å¤–çš„æ£€æŸ¥ã€‚</p>
<p>Defining <code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TRACE_REFS</span></code> enables reference tracing.  When defined, a
circular doubly linked list of active objects is maintained by adding two extra
fields to every <a class="reference internal" href="structures.html#c.PyObject" tppabs="https://docs.python.org/zh-cn/3/c-api/structures.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyObject</span></code></a>.  Total allocations are tracked as well.  Upon
exit, all existing references are printed.  (In interactive mode this happens
after every statement run by the interpreter.)  Implied by <code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_DEBUG</span></code>.</p>
<p>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Pythonæºä»£ç ä¸­çš„ <code class="file docutils literal notranslate"><span class="pre">Misc/SpecialBuilds.txt</span></code> ã€‚</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="contents.html" tppabs="https://docs.python.org/zh-cn/3/contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">æ¦‚è¿°</a><ul>
<li><a class="reference internal" href="#coding-standards">ä»£ç æ ‡å‡†</a></li>
<li><a class="reference internal" href="#include-files">åŒ…å«æ–‡ä»¶</a></li>
<li><a class="reference internal" href="#useful-macros">æœ‰ç”¨çš„å®</a></li>
<li><a class="reference internal" href="#objects-types-and-reference-counts">å¯¹è±¡ã€ç±»å‹å’Œå¼•ç”¨è®¡æ•°</a><ul>
<li><a class="reference internal" href="#reference-counts">å¼•ç”¨è®¡æ•°</a><ul>
<li><a class="reference internal" href="#reference-count-details">Reference Count Details</a></li>
</ul>
</li>
<li><a class="reference internal" href="#types">ç±»å‹</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exceptions">å¼‚å¸¸</a></li>
<li><a class="reference internal" href="#embedding-python">åµŒå…¥Python</a></li>
<li><a class="reference internal" href="#debugging-builds">è°ƒè¯•æ„å»º</a></li>
</ul>
</li>
</ul>

  <h4>ä¸Šä¸€ä¸ªä¸»é¢˜</h4>
  <p class="topless"><a href="index-9.html" tppabs="https://docs.python.org/zh-cn/3/c-api/index.html"
                        title="ä¸Šä¸€ç« ">Python/C API å‚è€ƒæ‰‹å†Œ</a></p>
  <h4>ä¸‹ä¸€ä¸ªä¸»é¢˜</h4>
  <p class="topless"><a href="stable.html" tppabs="https://docs.python.org/zh-cn/3/c-api/stable.html"
                        title="ä¸‹ä¸€ç« ">ç¨³å®šçš„åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£</a></p>
  <div role="note" aria-label="source link">
    <h3>æœ¬é¡µ</h3>
    <ul class="this-page-menu">
      <li><a href="bugs.html" tppabs="https://docs.python.org/zh-cn/3/bugs.html">æäº¤ Bug</a></li>
      <li>
        <a href="javascript:if(confirm('https://github.com/python/cpython/blob/3.7/Doc/c-api/intro.rst  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://github.com/python/cpython/blob/3.7/Doc/c-api/intro.rst'" tppabs="https://github.com/python/cpython/blob/3.7/Doc/c-api/intro.rst"
            rel="nofollow">æ˜¾ç¤ºæºä»£ç 
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>å¯¼èˆª</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" tppabs="https://docs.python.org/zh-cn/3/genindex.html" title="æ€»ç›®å½•"
             >ç´¢å¼•</a></li>
        <li class="right" >
          <a href="py-modindex.html" tppabs="https://docs.python.org/zh-cn/3/py-modindex.html" title="Python æ¨¡å—ç´¢å¼•"
             >æ¨¡å—</a> |</li>
        <li class="right" >
          <a href="stable.html" tppabs="https://docs.python.org/zh-cn/3/c-api/stable.html" title="ç¨³å®šçš„åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£"
             >ä¸‹ä¸€é¡µ</a> |</li>
        <li class="right" >
          <a href="index-9.html" tppabs="https://docs.python.org/zh-cn/3/c-api/index.html" title="Python/C API å‚è€ƒæ‰‹å†Œ"
             >ä¸Šä¸€é¡µ</a> |</li>
        <li><img src="py.png" tppabs="https://docs.python.org/zh-cn/3/_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="javascript:if(confirm('https://www.python.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.python.org/'" tppabs="https://www.python.org/">Python</a> &#187;</li>
        <li>
          <span class="language_switcher_placeholder">zh_CN</span>
          <span class="version_switcher_placeholder">3.7.3</span>
          <a href="index-11.html" tppabs="https://docs.python.org/zh-cn/3/index.html">æ–‡æ¡£</a> &#187;
        </li>

          <li class="nav-item nav-item-1"><a href="index-9.html" tppabs="https://docs.python.org/zh-cn/3/c-api/index.html" >Python/C API å‚è€ƒæ‰‹å†Œ</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="https://docs.python.org/zh-cn/3/search.html" method="get">
          <input placeholder="å¿«é€Ÿæœç´¢" type="text" name="q" />
          <input type="submit" value="è½¬å‘" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="copyright.html" tppabs="https://docs.python.org/zh-cn/3/copyright.html">ç‰ˆæƒæ‰€æœ‰</a> 2001-2019, Python Software Foundation.
    <br />
    Python è½¯ä»¶åŸºé‡‘ä¼šæ˜¯ä¸€ä¸ªéç›ˆåˆ©ç»„ç»‡ã€‚
    <a href="javascript:if(confirm('https://www.python.org/psf/donations/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.python.org/psf/donations/'" tppabs="https://www.python.org/psf/donations/">è¯·æåŠ©ã€‚</a>
    <br />
    æœ€åæ›´æ–°äº 4æœˆ 22, 2019.
    <a href="bugs.html" tppabs="https://docs.python.org/zh-cn/3/bugs.html">å‘ç°äº†é—®é¢˜</a>ï¼Ÿ
    <br />
    ä½¿ç”¨<a href="javascript:if(confirm('http://sphinx.pocoo.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://sphinx.pocoo.org/'" tppabs="http://sphinx.pocoo.org/">Sphinx</a>1.8.4 åˆ›å»ºã€‚
    </div>

  </body>
</html>