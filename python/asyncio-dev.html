
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ç”¨ asyncio å¼€å‘ &#8212; Python 3.7.3 æ–‡æ¡£</title>
    <link rel="stylesheet" href="pydoctheme.css" tppabs="https://docs.python.org/zh-cn/3/_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="pygments.css" tppabs="https://docs.python.org/zh-cn/3/_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="documentation_options.js" tppabs="https://docs.python.org/zh-cn/3/_static/documentation_options.js"></script>
    <script type="text/javascript" src="jquery.js" tppabs="https://docs.python.org/zh-cn/3/_static/jquery.js"></script>
    <script type="text/javascript" src="underscore.js" tppabs="https://docs.python.org/zh-cn/3/_static/underscore.js"></script>
    <script type="text/javascript" src="doctools.js" tppabs="https://docs.python.org/zh-cn/3/_static/doctools.js"></script>
    <script type="text/javascript" src="language_data.js" tppabs="https://docs.python.org/zh-cn/3/_static/language_data.js"></script>
    <script type="text/javascript" src="translations.js" tppabs="https://docs.python.org/zh-cn/3/_static/translations.js"></script>
    
    <script type="text/javascript" src="sidebar.js" tppabs="https://docs.python.org/zh-cn/3/_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="åœ¨ Python 3.7.3 æ–‡æ¡£ ä¸­æœç´¢"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="å…³äºè¿™äº›æ–‡æ¡£" href="../about.html" />
    <link rel="index" title="ç´¢å¼•" href="../genindex.html" />
    <link rel="search" title="æœç´¢" href="../search.html" />
    <link rel="copyright" title="ç‰ˆæƒæ‰€æœ‰" href="../copyright.html" />
    <link rel="next" title="socket --- åº•å±‚ç½‘ç»œæ¥å£" href="socket.html" />
    <link rel="prev" title="Low-level API Index" href="asyncio-llapi-index.html" />
    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    <link rel="canonical" href="https://docs.python.org/3/library/asyncio-dev.html" />
    
    <script type="text/javascript" src="copybutton.js" tppabs="https://docs.python.org/zh-cn/3/_static/copybutton.js"></script>
    <script type="text/javascript" src="switchers.js" tppabs="https://docs.python.org/zh-cn/3/_static/switchers.js"></script>
    
    
    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
 

  </head><body>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>å¯¼èˆª</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" tppabs="https://docs.python.org/zh-cn/3/genindex.html" title="æ€»ç›®å½•"
             accesskey="I">ç´¢å¼•</a></li>
        <li class="right" >
          <a href="py-modindex.html" tppabs="https://docs.python.org/zh-cn/3/py-modindex.html" title="Python æ¨¡å—ç´¢å¼•"
             >æ¨¡å—</a> |</li>
        <li class="right" >
          <a href="socket.html" tppabs="https://docs.python.org/zh-cn/3/library/socket.html" title="socket --- åº•å±‚ç½‘ç»œæ¥å£"
             accesskey="N">ä¸‹ä¸€é¡µ</a> |</li>
        <li class="right" >
          <a href="asyncio-llapi-index.html" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-llapi-index.html" title="Low-level API Index"
             accesskey="P">ä¸Šä¸€é¡µ</a> |</li>
        <li><img src="py.png" tppabs="https://docs.python.org/zh-cn/3/_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="javascript:if(confirm('https://www.python.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.python.org/'" tppabs="https://www.python.org/">Python</a> &#187;</li>
        <li>
          <span class="language_switcher_placeholder">zh_CN</span>
          <span class="version_switcher_placeholder">3.7.3</span>
          <a href="index-11.html" tppabs="https://docs.python.org/zh-cn/3/index.html">æ–‡æ¡£</a> &#187;
        </li>

          <li class="nav-item nav-item-1"><a href="index-2.html" tppabs="https://docs.python.org/zh-cn/3/library/index.html" >Python æ ‡å‡†åº“</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="ipc.html" tppabs="https://docs.python.org/zh-cn/3/library/ipc.html" >ç½‘ç»œå’Œè¿›ç¨‹é—´é€šä¿¡</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="asyncio.html" tppabs="https://docs.python.org/zh-cn/3/library/asyncio.html" accesskey="U"><code class="docutils literal notranslate"><span class="pre">asyncio</span></code> --- å¼‚æ­¥ I/O</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="https://docs.python.org/zh-cn/3/search.html" method="get">
          <input placeholder="å¿«é€Ÿæœç´¢" type="text" name="q" />
          <input type="submit" value="è½¬å‘" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="developing-with-asyncio">
<span id="asyncio-dev"></span><h1>ç”¨ asyncio å¼€å‘<a class="headerlink" href="#developing-with-asyncio" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h1>
<p>å¼‚æ­¥ç¼–ç¨‹ä¸ä¼ ç»Ÿçš„â€œé¡ºåºâ€ç¼–ç¨‹ä¸åŒã€‚</p>
<p>æœ¬é¡µåˆ—å‡ºå¸¸è§çš„é”™è¯¯å’Œé™·é˜±ï¼Œå¹¶è§£é‡Šå¦‚ä½•é¿å…å®ƒä»¬ã€‚</p>
<div class="section" id="debug-mode">
<span id="asyncio-debug-mode"></span><h2>Debug æ¨¡å¼<a class="headerlink" href="#debug-mode" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œasyncioä»¥ç”Ÿäº§æ¨¡å¼è¿è¡Œã€‚ä¸ºäº†ç®€åŒ–å¼€å‘ï¼Œasyncioæœ‰ä¸€ä¸ª*debug æ¨¡å¼* ã€‚</p>
<p>æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å¯ç”¨å¼‚æ­¥è°ƒè¯•æ¨¡å¼:</p>
<ul class="simple">
<li>å°† <span class="target" id="index-2"></span><a class="reference internal" href="cmdline.html#envvar-PYTHONASYNCIODEBUG" tppabs="https://docs.python.org/zh-cn/3/using/cmdline.html#envvar-PYTHONASYNCIODEBUG"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONASYNCIODEBUG</span></code></a> ç¯å¢ƒå˜é‡è®¾ç½®ä¸º <code class="docutils literal notranslate"><span class="pre">1</span></code> ã€‚</li>
<li>ä½¿ç”¨ <a class="reference internal" href="cmdline.html#id5" tppabs="https://docs.python.org/zh-cn/3/using/cmdline.html#id5"><code class="xref std std-option docutils literal notranslate"><span class="pre">-X</span></code></a> <code class="docutils literal notranslate"><span class="pre">dev</span></code> Python å‘½ä»¤è¡Œé€‰é¡¹ã€‚</li>
<li>å°† <code class="docutils literal notranslate"><span class="pre">debug=True</span></code> ä¼ é€’ç»™ <a class="reference internal" href="asyncio-task.html#asyncio.run" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.run" title="asyncio.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.run()</span></code></a> ã€‚</li>
<li>è°ƒç”¨ <a class="reference internal" href="asyncio-eventloop.html#asyncio.loop.set_debug" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.set_debug" title="asyncio.loop.set_debug"><code class="xref py py-meth docutils literal notranslate"><span class="pre">loop.set_debug()</span></code></a> ã€‚</li>
</ul>
<p>é™¤äº†å¯ç”¨è°ƒè¯•æ¨¡å¼å¤–ï¼Œè¿˜è¦è€ƒè™‘:</p>
<ul>
<li><p class="first">å°† <a class="reference internal" href="#asyncio-logger"><span class="std std-ref">asyncio logger</span></a> çš„æ—¥å¿—çº§åˆ«è®¾ç½®ä¸º <code class="xref py py-data docutils literal notranslate"><span class="pre">logging.DEBUG</span></code>ï¼Œä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ç‰‡æ®µå¯ä»¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è¿è¡Œ:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">é…ç½® <a class="reference internal" href="warnings.html#module-warnings" tppabs="https://docs.python.org/zh-cn/3/library/warnings.html#module-warnings" title="warnings: Issue warning messages and control their disposition."><code class="xref py py-mod docutils literal notranslate"><span class="pre">warnings</span></code></a> æ¨¡å—ä»¥æ˜¾ç¤º <a class="reference internal" href="exceptions.html#ResourceWarning" tppabs="https://docs.python.org/zh-cn/3/library/exceptions.html#ResourceWarning" title="ResourceWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ResourceWarning</span></code></a> è­¦å‘Šã€‚ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ <a class="reference internal" href="cmdline.html#cmdoption-w" tppabs="https://docs.python.org/zh-cn/3/using/cmdline.html#cmdoption-w"><code class="xref std std-option docutils literal notranslate"><span class="pre">-W</span></code></a> <code class="docutils literal notranslate"><span class="pre">default</span></code> å‘½ä»¤è¡Œé€‰é¡¹ã€‚</p>
</li>
</ul>
<p>å¯ç”¨è°ƒè¯•æ¨¡å¼æ—¶:</p>
<ul class="simple">
<li>asyncio æ£€æŸ¥ <a class="reference internal" href="#asyncio-coroutine-not-scheduled"><span class="std std-ref">æœªè¢«ç­‰å¾…çš„åç¨‹</span></a> å¹¶è®°å½•ä»–ä»¬ï¼›è¿™å°†æ¶ˆé™¤â€œè¢«é—å¿˜çš„ç­‰å¾…â€é—®é¢˜ã€‚</li>
<li>è®¸å¤šéçº¿ç¨‹å®‰å…¨çš„å¼‚æ­¥ APIs (ä¾‹å¦‚ <a class="reference internal" href="asyncio-eventloop.html#asyncio.loop.call_soon" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.call_soon" title="asyncio.loop.call_soon"><code class="xref py py-meth docutils literal notranslate"><span class="pre">loop.call_soon()</span></code></a> å’Œ <a class="reference internal" href="asyncio-eventloop.html#asyncio.loop.call_at" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.call_at" title="asyncio.loop.call_at"><code class="xref py py-meth docutils literal notranslate"><span class="pre">loop.call_at()</span></code></a> æ–¹æ³•)ï¼Œå¦‚æœä»é”™è¯¯çš„çº¿ç¨‹è°ƒç”¨ï¼Œåˆ™ä¼šå¼•å‘å¼‚å¸¸ã€‚</li>
<li>å¦‚æœæ‰§è¡ŒI/Oæ“ä½œèŠ±è´¹çš„æ—¶é—´å¤ªé•¿ï¼Œåˆ™è®°å½•I/Oé€‰æ‹©å™¨çš„æ‰§è¡Œæ—¶é—´ã€‚</li>
<li>Callbacks taking longer than 100ms are logged.  The
<code class="xref py py-attr docutils literal notranslate"><span class="pre">loop.slow_callback_duration</span></code> attribute can be used to set the
minimum execution duration in seconds that is considered &quot;slow&quot;.</li>
</ul>
</div>
<div class="section" id="concurrency-and-multithreading">
<span id="asyncio-multithreading"></span><h2>å¹¶å‘æ€§å’Œå¤šçº¿ç¨‹<a class="headerlink" href="#concurrency-and-multithreading" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>äº‹ä»¶å¾ªç¯åœ¨çº¿ç¨‹ä¸­è¿è¡Œ(é€šå¸¸æ˜¯ä¸»çº¿ç¨‹)ï¼Œå¹¶åœ¨å…¶çº¿ç¨‹ä¸­æ‰§è¡Œæ‰€æœ‰å›è°ƒå’Œä»»åŠ¡ã€‚å½“ä¸€ä¸ªä»»åŠ¡åœ¨äº‹ä»¶å¾ªç¯ä¸­è¿è¡Œæ—¶ï¼Œæ²¡æœ‰å…¶ä»–ä»»åŠ¡å¯ä»¥åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œã€‚å½“ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œä¸€ä¸ª <code class="docutils literal notranslate"><span class="pre">await</span></code> è¡¨è¾¾å¼æ—¶ï¼Œæ­£åœ¨è¿è¡Œçš„ä»»åŠ¡è¢«æŒ‚èµ·ï¼Œäº‹ä»¶å¾ªç¯æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</p>
<p>è¦è°ƒåº¦æ¥è‡ªä¸åŒOSçº¿ç¨‹çš„å›è°ƒå‡½æ•°ï¼Œåº”è¯¥ä½¿ç”¨ <a class="reference internal" href="asyncio-eventloop.html#asyncio.loop.call_soon_threadsafe" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.call_soon_threadsafe" title="asyncio.loop.call_soon_threadsafe"><code class="xref py py-meth docutils literal notranslate"><span class="pre">loop.call_soon_threadsafe()</span></code></a>  æ–¹æ³•ã€‚ä¾‹å¦‚:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">call_soon_threadsafe</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>å‡ ä¹æ‰€æœ‰å¼‚æ­¥å¯¹è±¡éƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™é€šå¸¸ä¸æ˜¯é—®é¢˜ï¼Œé™¤éåœ¨ä»»åŠ¡æˆ–å›è°ƒå‡½æ•°ä¹‹å¤–æœ‰ä»£ç å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚å¦‚æœéœ€è¦è¿™æ ·çš„ä»£ç æ¥è°ƒç”¨ä½çº§å¼‚æ­¥APIï¼Œåº”è¯¥ä½¿ç”¨ <a class="reference internal" href="asyncio-eventloop.html#asyncio.loop.call_soon_threadsafe" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.call_soon_threadsafe" title="asyncio.loop.call_soon_threadsafe"><code class="xref py py-meth docutils literal notranslate"><span class="pre">loop.call_soon_threadsafe()</span></code></a> æ–¹æ³•ï¼Œä¾‹å¦‚:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">call_soon_threadsafe</span><span class="p">(</span><span class="n">fut</span><span class="o">.</span><span class="n">cancel</span><span class="p">)</span>
</pre></div>
</div>
<p>è¦ä»ä¸åŒçš„OSçº¿ç¨‹è°ƒåº¦ä¸€ä¸ªåç¨‹å¯¹è±¡ï¼Œåº”è¯¥ä½¿ç”¨ <a class="reference internal" href="asyncio-task.html#asyncio.run_coroutine_threadsafe" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.run_coroutine_threadsafe" title="asyncio.run_coroutine_threadsafe"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_coroutine_threadsafe()</span></code></a> å‡½æ•°ã€‚å®ƒè¿”å›ä¸€ä¸ª <a class="reference internal" href="concurrent.futures.html#concurrent.futures.Future" tppabs="https://docs.python.org/zh-cn/3/library/concurrent.futures.html#concurrent.futures.Future" title="concurrent.futures.Future"><code class="xref py py-class docutils literal notranslate"><span class="pre">concurrent.futures.Future</span></code></a> ã€‚æŸ¥è¯¢ç»“æœ:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">coro_func</span><span class="p">():</span>
     <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>

<span class="c1"># Later in another OS thread:</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run_coroutine_threadsafe</span><span class="p">(</span><span class="n">coro_func</span><span class="p">(),</span> <span class="n">loop</span><span class="p">)</span>
<span class="c1"># Wait for the result:</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>
</div>
<p>ä¸ºäº†èƒ½å¤Ÿå¤„ç†ä¿¡å·å’Œæ‰§è¡Œå­è¿›ç¨‹ï¼Œäº‹ä»¶å¾ªç¯å¿…é¡»è¿è¡Œäºä¸»çº¿ç¨‹ä¸­ã€‚</p>
<p>The <a class="reference internal" href="asyncio-eventloop.html#asyncio.loop.run_in_executor" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.run_in_executor" title="asyncio.loop.run_in_executor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">loop.run_in_executor()</span></code></a> method can be used with a
<a class="reference internal" href="concurrent.futures.html#concurrent.futures.ThreadPoolExecutor" tppabs="https://docs.python.org/zh-cn/3/library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor" title="concurrent.futures.ThreadPoolExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">concurrent.futures.ThreadPoolExecutor</span></code></a> to execute
blocking code in a different OS thread without blocking the OS thread
that the event loop runs in.</p>
</div>
<div class="section" id="running-blocking-code">
<span id="asyncio-handle-blocking"></span><h2>è¿è¡Œé˜»å¡çš„ä»£ç <a class="headerlink" href="#running-blocking-code" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>ä¸åº”è¯¥ç›´æ¥è°ƒç”¨é˜»å¡( CPU ç»‘å®š)ä»£ç ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°æ‰§è¡Œ1ç§’çš„ CPU å¯†é›†å‹è®¡ç®—ï¼Œé‚£ä¹ˆæ‰€æœ‰å¹¶å‘å¼‚æ­¥ä»»åŠ¡å’Œ IO æ“ä½œéƒ½å°†å»¶è¿Ÿ1ç§’ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨æ‰§è¡Œå™¨åœ¨ä¸åŒçš„çº¿ç¨‹ç”šè‡³ä¸åŒçš„è¿›ç¨‹ä¸­è¿è¡Œä»»åŠ¡ï¼Œä»¥é¿å…ä½¿ç”¨äº‹ä»¶å¾ªç¯é˜»å¡OSçº¿ç¨‹ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ <a class="reference internal" href="asyncio-eventloop.html#asyncio.loop.run_in_executor" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.run_in_executor" title="asyncio.loop.run_in_executor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">loop.run_in_executor()</span></code></a>  æ–¹æ³•ã€‚</p>
</div>
<div class="section" id="logging">
<span id="asyncio-logger"></span><h2>æ—¥å¿—<a class="headerlink" href="#logging" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>asyncioä½¿ç”¨ <a class="reference internal" href="logging.html#module-logging" tppabs="https://docs.python.org/zh-cn/3/library/logging.html#module-logging" title="logging: Flexible event logging system for applications."><code class="xref py py-mod docutils literal notranslate"><span class="pre">logging</span></code></a> æ¨¡å—ï¼Œæ‰€æœ‰æ—¥å¿—è®°å½•éƒ½æ˜¯é€šè¿‡ <code class="docutils literal notranslate"><span class="pre">&quot;asyncio&quot;</span></code> loggeræ‰§è¡Œçš„ã€‚</p>
<p>é»˜è®¤æ—¥å¿—çº§åˆ«æ˜¯ <code class="xref py py-data docutils literal notranslate"><span class="pre">logging.INFO</span></code> ã€‚å¯ä»¥å¾ˆå®¹æ˜“åœ°è°ƒæ•´:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;asyncio&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="detect-never-awaited-coroutines">
<span id="asyncio-coroutine-not-scheduled"></span><h2>æ£€æµ‹ never-awaited ååŒç¨‹åº<a class="headerlink" href="#detect-never-awaited-coroutines" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>When a coroutine function is called, but not awaited
(e.g. <code class="docutils literal notranslate"><span class="pre">coro()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">coro()</span></code>)
or the coroutine is not scheduled with <a class="reference internal" href="asyncio-task.html#asyncio.create_task" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.create_task" title="asyncio.create_task"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asyncio.create_task()</span></code></a>, asyncio
will emit a <a class="reference internal" href="exceptions.html#RuntimeWarning" tppabs="https://docs.python.org/zh-cn/3/library/exceptions.html#RuntimeWarning" title="RuntimeWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeWarning</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;never scheduled&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">test</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>è¾“å‡º:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span> <span class="ne">RuntimeWarning</span><span class="p">:</span> <span class="n">coroutine</span> <span class="s1">&#39;test&#39;</span> <span class="n">was</span> <span class="n">never</span> <span class="n">awaited</span>
  <span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p>è°ƒè¯•æ¨¡å¼çš„è¾“å‡º:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span> <span class="ne">RuntimeWarning</span><span class="p">:</span> <span class="n">coroutine</span> <span class="s1">&#39;test&#39;</span> <span class="n">was</span> <span class="n">never</span> <span class="n">awaited</span>
<span class="n">Coroutine</span> <span class="n">created</span> <span class="n">at</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;../t.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">9</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">(),</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

  <span class="o">&lt;</span> <span class="o">..</span> <span class="o">&gt;</span>

  <span class="n">File</span> <span class="s2">&quot;../t.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">7</span><span class="p">,</span> <span class="ow">in</span> <span class="n">main</span>
    <span class="n">test</span><span class="p">()</span>
  <span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
<p>é€šå¸¸çš„ä¿®å¤æ–¹æ³•æ˜¯ç­‰å¾…åç¨‹æˆ–è€…è°ƒç”¨ <a class="reference internal" href="asyncio-task.html#asyncio.create_task" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.create_task" title="asyncio.create_task"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asyncio.create_task()</span></code></a> å‡½æ•°:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="detect-never-retrieved-exceptions">
<h2>æ£€æµ‹å°±å†ä¹Ÿæ²¡å¼‚å¸¸<a class="headerlink" href="#detect-never-retrieved-exceptions" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>å¦‚æœè°ƒç”¨ <a class="reference internal" href="asyncio-future.html#asyncio.Future.set_exception" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-future.html#asyncio.Future.set_exception" title="asyncio.Future.set_exception"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Future.set_exception()</span></code></a> ï¼Œä½†ä¸ç­‰å¾… Future å¯¹è±¡ï¼Œå°†å¼‚å¸¸ä¼ æ’­åˆ°ç”¨æˆ·ä»£ç ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ Future å¯¹è±¡è¢«åƒåœ¾æ”¶é›†æ—¶ï¼Œasyncioå°†å‘å‡ºä¸€æ¡æ—¥å¿—æ¶ˆæ¯ã€‚</p>
<p>æœªå¤„ç†å¼‚å¸¸çš„ä¾‹å­:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">bug</span><span class="p">():</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;not consumed&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">bug</span><span class="p">())</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>è¾“å‡º:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">Task</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">never</span> <span class="n">retrieved</span>
<span class="n">future</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">Task</span> <span class="n">finished</span> <span class="n">coro</span><span class="o">=&lt;</span><span class="n">bug</span><span class="p">()</span> <span class="n">done</span><span class="p">,</span> <span class="n">defined</span> <span class="n">at</span> <span class="n">test</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">3</span><span class="o">&gt;</span>
  <span class="n">exception</span><span class="o">=</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not consumed&#39;</span><span class="p">)</span><span class="o">&gt;</span>

<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;test.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">4</span><span class="p">,</span> <span class="ow">in</span> <span class="n">bug</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;not consumed&quot;</span><span class="p">)</span>
<span class="ne">Exception</span><span class="p">:</span> <span class="ow">not</span> <span class="n">consumed</span>
</pre></div>
</div>
<p><a class="reference internal" href="#asyncio-debug-mode"><span class="std std-ref">Enable the debug mode</span></a> to get the
traceback where the task was created:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">(),</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>è°ƒè¯•æ¨¡å¼çš„è¾“å‡º:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">Task</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">never</span> <span class="n">retrieved</span>
<span class="n">future</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">Task</span> <span class="n">finished</span> <span class="n">coro</span><span class="o">=&lt;</span><span class="n">bug</span><span class="p">()</span> <span class="n">done</span><span class="p">,</span> <span class="n">defined</span> <span class="n">at</span> <span class="n">test</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">3</span><span class="o">&gt;</span>
    <span class="n">exception</span><span class="o">=</span><span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;not consumed&#39;</span><span class="p">)</span> <span class="n">created</span> <span class="n">at</span> <span class="n">asyncio</span><span class="o">/</span><span class="n">tasks</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">321</span><span class="o">&gt;</span>

<span class="n">source_traceback</span><span class="p">:</span> <span class="n">Object</span> <span class="n">created</span> <span class="n">at</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;../t.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">9</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">(),</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="o">&lt;</span> <span class="o">..</span> <span class="o">&gt;</span>

<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;../t.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">4</span><span class="p">,</span> <span class="ow">in</span> <span class="n">bug</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;not consumed&quot;</span><span class="p">)</span>
<span class="ne">Exception</span><span class="p">:</span> <span class="ow">not</span> <span class="n">consumed</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="contents.html" tppabs="https://docs.python.org/zh-cn/3/contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">ç”¨ asyncio å¼€å‘</a><ul>
<li><a class="reference internal" href="#debug-mode">Debug æ¨¡å¼</a></li>
<li><a class="reference internal" href="#concurrency-and-multithreading">å¹¶å‘æ€§å’Œå¤šçº¿ç¨‹</a></li>
<li><a class="reference internal" href="#running-blocking-code">è¿è¡Œé˜»å¡çš„ä»£ç </a></li>
<li><a class="reference internal" href="#logging">æ—¥å¿—</a></li>
<li><a class="reference internal" href="#detect-never-awaited-coroutines">æ£€æµ‹ never-awaited ååŒç¨‹åº</a></li>
<li><a class="reference internal" href="#detect-never-retrieved-exceptions">æ£€æµ‹å°±å†ä¹Ÿæ²¡å¼‚å¸¸</a></li>
</ul>
</li>
</ul>

  <h4>ä¸Šä¸€ä¸ªä¸»é¢˜</h4>
  <p class="topless"><a href="asyncio-llapi-index.html" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-llapi-index.html"
                        title="ä¸Šä¸€ç« ">Low-level API Index</a></p>
  <h4>ä¸‹ä¸€ä¸ªä¸»é¢˜</h4>
  <p class="topless"><a href="socket.html" tppabs="https://docs.python.org/zh-cn/3/library/socket.html"
                        title="ä¸‹ä¸€ç« "><code class="docutils literal notranslate"><span class="pre">socket</span></code> --- åº•å±‚ç½‘ç»œæ¥å£</a></p>
  <div role="note" aria-label="source link">
    <h3>æœ¬é¡µ</h3>
    <ul class="this-page-menu">
      <li><a href="bugs.html" tppabs="https://docs.python.org/zh-cn/3/bugs.html">æäº¤ Bug</a></li>
      <li>
        <a href="javascript:if(confirm('https://github.com/python/cpython/blob/3.7/Doc/library/asyncio-dev.rst  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://github.com/python/cpython/blob/3.7/Doc/library/asyncio-dev.rst'" tppabs="https://github.com/python/cpython/blob/3.7/Doc/library/asyncio-dev.rst"
            rel="nofollow">æ˜¾ç¤ºæºä»£ç 
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>å¯¼èˆª</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" tppabs="https://docs.python.org/zh-cn/3/genindex.html" title="æ€»ç›®å½•"
             >ç´¢å¼•</a></li>
        <li class="right" >
          <a href="py-modindex.html" tppabs="https://docs.python.org/zh-cn/3/py-modindex.html" title="Python æ¨¡å—ç´¢å¼•"
             >æ¨¡å—</a> |</li>
        <li class="right" >
          <a href="socket.html" tppabs="https://docs.python.org/zh-cn/3/library/socket.html" title="socket --- åº•å±‚ç½‘ç»œæ¥å£"
             >ä¸‹ä¸€é¡µ</a> |</li>
        <li class="right" >
          <a href="asyncio-llapi-index.html" tppabs="https://docs.python.org/zh-cn/3/library/asyncio-llapi-index.html" title="Low-level API Index"
             >ä¸Šä¸€é¡µ</a> |</li>
        <li><img src="py.png" tppabs="https://docs.python.org/zh-cn/3/_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="javascript:if(confirm('https://www.python.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.python.org/'" tppabs="https://www.python.org/">Python</a> &#187;</li>
        <li>
          <span class="language_switcher_placeholder">zh_CN</span>
          <span class="version_switcher_placeholder">3.7.3</span>
          <a href="index-11.html" tppabs="https://docs.python.org/zh-cn/3/index.html">æ–‡æ¡£</a> &#187;
        </li>

          <li class="nav-item nav-item-1"><a href="index-2.html" tppabs="https://docs.python.org/zh-cn/3/library/index.html" >Python æ ‡å‡†åº“</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="ipc.html" tppabs="https://docs.python.org/zh-cn/3/library/ipc.html" >ç½‘ç»œå’Œè¿›ç¨‹é—´é€šä¿¡</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="asyncio.html" tppabs="https://docs.python.org/zh-cn/3/library/asyncio.html" ><code class="docutils literal notranslate"><span class="pre">asyncio</span></code> --- å¼‚æ­¥ I/O</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="https://docs.python.org/zh-cn/3/search.html" method="get">
          <input placeholder="å¿«é€Ÿæœç´¢" type="text" name="q" />
          <input type="submit" value="è½¬å‘" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="copyright.html" tppabs="https://docs.python.org/zh-cn/3/copyright.html">ç‰ˆæƒæ‰€æœ‰</a> 2001-2019, Python Software Foundation.
    <br />
    Python è½¯ä»¶åŸºé‡‘ä¼šæ˜¯ä¸€ä¸ªéç›ˆåˆ©ç»„ç»‡ã€‚
    <a href="javascript:if(confirm('https://www.python.org/psf/donations/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.python.org/psf/donations/'" tppabs="https://www.python.org/psf/donations/">è¯·æåŠ©ã€‚</a>
    <br />
    æœ€åæ›´æ–°äº 4æœˆ 22, 2019.
    <a href="bugs.html" tppabs="https://docs.python.org/zh-cn/3/bugs.html">å‘ç°äº†é—®é¢˜</a>ï¼Ÿ
    <br />
    ä½¿ç”¨<a href="javascript:if(confirm('http://sphinx.pocoo.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://sphinx.pocoo.org/'" tppabs="http://sphinx.pocoo.org/">Sphinx</a>1.8.4 åˆ›å»ºã€‚
    </div>

  </body>
</html>